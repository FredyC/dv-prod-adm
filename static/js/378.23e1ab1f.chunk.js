(this.webpackJsonpspeedlo=this.webpackJsonpspeedlo||[]).push([[378],{1368:function(e,n,t){"use strict";t.d(n,"a",(function(){return l}));var a=t(61),r=t(0),i=t.n(r),c=t(1360),o=t(1370),l=Object(a.b)((function(e){var n=e.mutationName,t=e.children;return Object(c.b)(n)?i.a.createElement(i.a.Fragment,null,t):i.a.createElement(o.a,null,"No access to mutation ".concat(n))}))},1374:function(e,n,t){"use strict";t.d(n,"a",(function(){return i}));var a=t(4);function r(){var e=Object(a.a)(["\n  display: flex;\n  flex-direction: row;\n  flex-wrap: ",";\n  justify-content: ",";\n"]);return r=function(){return e},e}var i=t(18).c.div(r(),(function(e){var n=e.flexWrap;return void 0===n?"unset":n}),(function(e){var n=e.justify;return void 0===n?"space-between":n}))},1375:function(e,n,t){"use strict";t.d(n,"a",(function(){return i}));var a=t(4);function r(){var e=Object(a.a)(["\n  flex: ",";\n  padding: ",";\n  margin: ",";\n"]);return r=function(){return e},e}var i=t(18).c.div(r(),(function(e){var n=e.fixedWidth,t=void 0!==n&&n,a=e.width,r=e.widthGrowIndex,i=void 0===r?0:r;return t?a?"0 0 ".concat(a):"0 0":"".concat(i," 0")}),(function(e){var n=e.padding;return void 0===n?"0.25rem":n}),(function(e){var n=e.margin;return void 0===n?"":n}))},1376:function(e,n,t){"use strict";var a=t(4),r=t(18),i=t(0),c=t.n(i),o=t(44);function l(){var e=Object(a.a)(["\n  overflow-y: auto;\n  -webkit-overflow-scrolling: touch;\n  height: 100%;\n"]);return l=function(){return e},e}var u=r.c.div(l()),d=t(158),s=t(14);function m(){var e=Object(a.a)(["\n    margin: 0;\n    grid-row: "," ;\n    grid-column: span 16;\n    height: "," ;\n    position: relative;\n  "]);return m=function(){return e},e}function f(){var e=Object(a.a)(["\n  position: fixed;\n  bottom: 0.5rem;\n  width: ",";\n  left: ",";\n  top: ",";"]);return f=function(){return e},e}t.d(n,"a",(function(){return p}));var b=r.c.div.withConfig({displayName:"StyledPageLayoutFullHeightItem",componentId:"sc-1mean6j-0"})([""," ",""],Object(o.c)(f(),(function(e){return void 0!==e.widthInColumns?"calc(("+e.widthInColumns+" * 6.22vw) - "+s.d.LayoutGridCellMargin+")":"calc(100vh - (2 * "+s.d.LayoutGridCellMargin+"))"}),(function(e){return void 0!==e.column?"calc(("+e.column+" * 6.22vw) + "+s.d.LayoutGridCellMargin+")":s.d.LayoutGridCellMargin}),(function(e){return void 0!==e.row?"calc(("+e.row+" * 3.9375rem) + "+s.d.LayoutGridCellMargin+")":"calc(3.9375rem + "+s.d.LayoutGridCellMargin+")"})),Object(o.d)(m(),(function(e){return e.rowInMobile}),(function(e){var n=e.forcePercentHeightInMobile;return n?"calc(".concat(n,"vh - ").concat(s.d.PageHeaderHeight+.25+s.d.DefaultSizeUnit,")"):"unset"}))),p=function(e){var n=e.children,t=e.row,a=void 0===t?1:t,r=e.rowInMobile,i=void 0===r?16:r,l=e.column,s=void 0===l?0:l,m=e.widthInColumns,f=void 0===m?16:m,p=e.withScrollArea,v=void 0!==p&&p,g=e.scrollAreaId,h=e.forcePercentHeightInMobile,O=Object(o.f)().isMobile;return c.a.createElement(b,{column:s,row:a,rowInMobile:i,widthInColumns:f,withScrollArea:v,forcePercentHeightInMobile:h},v&&!O?c.a.createElement(u,{id:g},n):c.a.createElement(d.a,{height:100,heightUnit:"%"},n))}},1382:function(e,n,t){"use strict";t.d(n,"a",(function(){return i}));var a=t(0),r=t.n(a);function i(e){var n=e.getOptionFilter,t="function"===typeof n;return{filterOption:r.a.useCallback((function(e,t){return!n||0===t.length||n(e.data).toLocaleLowerCase().includes(t.toLocaleLowerCase())}),[n]),isSearchable:t}}},1384:function(e,n,t){"use strict";t.d(n,"a",(function(){return i}));var a=t(4);function r(){var e=Object(a.a)(["\n  height: ",";\n"]);return r=function(){return e},e}var i=t(18).c.div(r(),(function(e){var n=e.size,t=void 0===n?1:n,a=e.sizeUnit,r=void 0===a?"rem":a;return"".concat(t).concat(r)}));i.displayName="VerticalGap"},1386:function(e,n,t){"use strict";t.d(n,"a",(function(){return s})),t.d(n,"b",(function(){return m}));var a=t(89),r=t(46),i=t(65),c=t(1357),o=t(61),l=t(0),u=t.n(l),d=t(1363),s=u.a.forwardRef((function(e,n){var t=e.fieldName,a=e.fullWidth,r=e.validate,c=e.addHiddenLabelWithPlaceholderText,l=void 0===c||c,s=Object(i.a)(e,["fieldName","fullWidth","validate","addHiddenLabelWithPlaceholderText"]),f=m({fieldName:t,validate:r});return Object(o.g)((function(){return u.a.createElement(u.a.Fragment,null,u.a.createElement(d.b,Object.assign({},f(),{inputFullWidth:a,ref:n},s)),l&&s.placeholder&&u.a.createElement("label",{hidden:!0,htmlFor:f().id},s.placeholder))}))}));function m(e){var n=e.fieldName,t=e.validate,i=Object(c.i)(),o=Object(c.e)(n,{validate:t}),l=Object(r.a)(o,2),u=l[0],d=l[1];return function(){return Object(a.a)({},d(),{disabled:i.isSubmitting,invalid:u.touched&&Boolean(u.error)})}}},1415:function(e,n,t){"use strict";t.d(n,"a",(function(){return d}));var a=t(65),r=t(1641),i=t(0),c=t.n(i),o=t(438),l=t(14),u=t(131),d=function(e){var n=e.onDelete,t=e.confirmText,i=Object(a.a)(e,["onDelete","confirmText"]);return c.a.createElement(o.a,null,c.a.createElement(u.a,Object.assign({className:"delete-button",icon:r.a,color:l.a.greyMiddle,onClick:function(e){e.preventDefault(),t&&!window.confirm(t)||n()}},i)))}},1419:function(e,n,t){"use strict";t.d(n,"a",(function(){return i}));var a=t(0),r=t.n(a);function i(e){var n=e.options,t=e.selected,a=e.onSelectionChange,i=e.getOptionValue;return{value:r.a.useMemo((function(){return null===t?null:null===n?null:n.find((function(e){return i(e)===t}))||null}),[t,n,i]),onChange:function(e){a(e?i(e):null)},getOptionValue:i}}},1430:function(e,n,t){"use strict";t.d(n,"a",(function(){return m}));var a=t(65),r=t(2776),i=t(1362),c=t(1357),o=t(61),l=t(0),u=t.n(l),d=t(131),s=t(14),m=function(e){var n=e.children,t=e.id,l=void 0===t?"form-submit":t,m=Object(a.a)(e,["children","id"]),f=Object(c.i)();return Object(o.g)((function(){return u.a.createElement(d.a,Object.assign({id:l,type:"submit",color:s.a.green,disabled:f.isSubmitting,icon:f.isValid?void 0:r.a,iconSize:1.1,iconColor:s.a.red},m,{className:Object(i.b)(m.className,"animated","infinite",{heartBeat:f.isSubmitting})}),u.a.createElement(u.a.Fragment,null,n))}))}},1467:function(e,n,t){"use strict";t.d(n,"a",(function(){return f})),t.d(n,"b",(function(){return b}));var a=t(79),r=t(1424),i=t(67),c=t(61),o=t(0),l=t.n(o),u=t(63),d=t(14),s=t(40),m=(l.a.createContext(null),["places"]),f=function(e){var n=e.model,t=e.children,o={streetViewControl:!1,mapTypeControl:!1,fullscreenControl:!1},f=Object(s.b)().user,b=Object(r.e)({id:"script-loader",version:"weekly",googleMapsApiKey:u.a.googleMapsApi,libraries:m,language:f.language}),p=b.isLoaded,v=b.loadError,g=b.url,h=Reflect.has(window,"google");return v||p&&!h?(i.a.withScope((function(e){e.setExtras({googleMapUrl:g}),i.a.captureException(v)})),l.a.createElement("h2",null,l.a.createElement(a.Trans,{id:"Cannot load map right now. Please try again later."}))):p?l.a.createElement(c.a,null,(function(){return l.a.createElement(r.a,{zoom:n.zoom,center:n.center,onCenterChanged:n.updatePosition,onZoomChanged:n.updateZoom,onLoad:n.setMapRef,options:o,mapContainerStyle:{borderRadius:d.c.Card,overflow:"hidden",height:"100%"}},t)})):null};function b(){var e=Object(r.d)();if(!e)throw new Error("Trying to useGoogleMap, but BaseMap is missing in the tree");return e}},1469:function(e,n,t){"use strict";t.d(n,"a",(function(){return i}));var a=t(18),r=t(14),i=a.c.h2.withConfig({displayName:"CardListTitle",componentId:"dr5aqq-0"})(["color:",";font-weight:lighter;font-size:1.2rem;margin:0.8rem 0 0.8rem 0.3rem;@media print{color:",";}"],r.a.greyLight,r.a.black)},1471:function(e,n,t){"use strict";t.d(n,"a",(function(){return f}));var a=t(89),r=t(65),i=t(1357),c=t(61),o=t(0),l=t.n(o),u=t(1361),d=t(1382),s=t(1419),m=t(20),f=function(e){var n=e.fieldName,t=e.getOptionValue,o=void 0===t?m.b:t,f=e.getOptionFilter,b=Object(r.a)(e,["fieldName","getOptionValue","getOptionFilter"]),p=Object(i.i)(),v=Object(i.d)(n);return Object(c.g)((function(){var e=Object(s.a)(Object(a.a)({},b,{onSelectionChange:v.setValue,selected:v.value,getOptionValue:o})),n=Object(d.a)({getOptionFilter:f});return l.a.createElement(u.a,Object.assign({},e,n,b,{onFocus:function(){return v.setTouched()},invalid:v.touched&&v.hasError,isDisabled:p.isSubmitting}))}))}},1527:function(e,n,t){"use strict";t.d(n,"a",(function(){return o}));var a=t(1357),r=t(61),i=t(0),c=t.n(i),o=function(e){var n=e.fieldName,t=e.className,i=Object(a.f)(n);return Object(r.g)((function(){return c.a.createElement("span",{className:t},i.value)}))}},1528:function(e,n,t){"use strict";t.d(n,"a",(function(){return m}));var a=t(4),r=t(2799),i=t(0),c=t.n(i),o=t(1472),l=t(18),u=t(240);function d(){var e=Object(a.a)(["\n  padding: 1rem 0.4rem;\n  cursor: grab;\n"]);return d=function(){return e},e}var s=l.c.div(d()),m=Object(o.c)((function(){return c.a.createElement(s,null,c.a.createElement(u.a,{icon:r.a}))}))},1555:function(e,n,t){"use strict";t.d(n,"a",(function(){return r}));var a=t(0),r=function(e){var n=e.isShow,t=e.confirmText,r=e.onCancel,i=e.onConfirm;return Object(a.useEffect)((function(){n&&(window.confirm(t)?i():r())}),[t,n,r,i]),null}},1574:function(e,n,t){"use strict";t.d(n,"a",(function(){return m}));var a=t(65),r=t(0),i=t.n(r),c=t(40),o=t(1361),l=t(1382),u=t(36),d=t(20),s=d.a.prop("name"),m=function(e){var n=e.brands,t=e.selectedBrand,r=e.onSelection,m=Object(a.a)(e,["brands","selectedBrand","onSelection"]),f=Object(c.b)().user,b=Object(l.a)({getOptionFilter:s});return i.a.createElement(o.a,Object.assign({placeholder:u.b._("Select brand"),options:n||f.brands,value:t,formatOptionLabel:s,getOptionValue:d.b,getOptionLabel:s,onChange:function(e){return r(e)},isClearable:!0,autoFocus:!0},b,m))}},1575:function(e,n,t){"use strict";t.d(n,"a",(function(){return s}));var a=t(54),r=t.n(a),i=t(47),c=t(1357),o=t(0),l=t.n(o),u=(t(42),t(255)),d=void 0;function s(e){var n=e.onSubmit,t=e.initialValues,a=e.loadValues,o=e.validationSchema,s=e.submitMessage,m=e.submitRedirectPath,f=Object(i.l)().history,b=Object(u.a)(),p=b.enqueueSuccess,v=b.enqueueWarning,g=l.a.useCallback((function(e){return r.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.a.awrap(n(e));case 2:s&&p(s),m&&f.push(m);case 4:case"end":return t.stop()}}))}),[p,f,n,s,m]),h=l.a.useCallback((function(e,n){var t=!0,a=!1,r=void 0;try{for(var i,c=n.values()[Symbol.iterator]();!(t=(i=c.next()).done);t=!0){var o=i.value;o&&v(o)}}catch(l){a=!0,r=l}finally{try{t||null==c.return||c.return()}finally{if(a)throw r}}}),[v]),O=l.a.useRef(!1),E=l.a.useCallback((function(){O.current=!1}),[]),j=Object(c.g)({onSubmit:g,onSubmitFailed:h,onReset:E,validationSchema:o,initialValues:t,initialValidationEnabled:void 0===a,ignoreUnknownFieldsInValidation:!0,onFormChanges:d});return l.a.useEffect((function(){O.current||(a&&Promise.resolve(a(j.state.initialValues)).then((function(e){e&&(j.api.mergeValues(e),j.state.pristineValues=j.state.values),j.api.enableValidation()})),O.current=!0)}),[a,j]),j}},1576:function(e,n,t){"use strict";t.d(n,"a",(function(){return f}));var a=t(89),r=t(4),i=t(0),c=t.n(i),o=t(18),l=t(14),u=t(20),d=t(1471);function s(){var e=Object(r.a)(["\n  background-color: ",";\n  color: ",";\n  width: 6rem;\n  padding: 0.4rem 1rem;\n  margin: 0;\n  height: 100%;\n"]);return s=function(){return e},e}var m=o.c.div(s(),(function(e){return e.color}),l.a.white),f=function(e){var n=e.fieldName,t=e.colors,r=e.isLoading;return c.a.createElement(d.a,{fieldName:n,options:t,isLoading:r,width:8,styles:{option:function(e){return Object(a.a)({},e,{padding:0,margin:0})},menu:function(e){return Object(a.a)({},e,{width:"8rem",maxWidth:"8rem"})}},defaultValue:u.a.head(t),getOptionValue:u.b,formatOptionLabel:function(e){var n=e.color,t=e.code;return c.a.createElement(m,{color:n},t)}})}},2806:function(e,n,t){"use strict";t.r(n);var a=t(0),r=t.n(a),i=t(59),c=t(259),o=t(442),l=t(36),u=t(1376),d=t(446),s=t(54),m=t.n(s),f=t(89),b=t(46),p=t(1357),v=t(1575),g=t(78),h=t(1358),O=t(177),E=t(258),j=t(255),y=t(20),w=t(47),C=t(40);function z(){var e=Object(C.b)().user,n=Object(w.l)().history,t=r.a.useCallback((function(e){return"".concat(o.f,"/").concat(e)}),[]);return{getRouteToZone:t,routeToZoneEdit:r.a.useCallback((function(a){e.canQuery("zone")&&n.push(t(a))}),[t,n,e]),routeToZoneList:r.a.useCallback((function(){n.push(o.f)}),[n])}}var x=function(e){var n=e.children,t=e.zoneId,a=z().routeToZoneList,i=Object(j.a)().enqueueSuccess,c=Object(g.rb)(),o=Object(b.a)(c,1)[0],u=Object(p.c)((function(e){return{name:e.string().required(),minimalPrice:Object(h.e)(l.b._("Minimal price")).min(0,Object(h.b)(l.b._("Minimal price")))}})),d=r.a.useRef(),s=r.a.useCallback((function(e){return m.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,m.a.awrap(o({zoneId:e.id,update:S(e)}));case 2:n.sent&&(d.current.pristineValues=Object(f.a)({},e),a(),i(l.b._("Zone has been updated")));case 4:case"end":return n.stop()}}))}),[i,a,o]),E=Object(v.a)({initialValues:{id:"",type:g.p.Area,name:"",enabled:!0,branchId:"",zoneColor:"",geoPolygon:[],minimalPrice:"0",priceRules:{},priceRulesOrder:[],currencyCode:""},onSubmit:s,validationSchema:u});d.current=E.state;var w=!t,C=Object(g.vc)({zoneId:t},{skip:w}),x=C.getStash,k=C.error,P=x((function(e){return function(e){return Object(f.a)({id:e.id,type:e.zoneType.enum,name:e.name,enabled:e.enabled,zoneColor:e.zoneColor.id,branchId:e.branchWithCurrency.id,geoPolygon:e.geoPolygon.map(I),currencyCode:e.branchWithCurrency.currency.code,minimalPrice:Object(O.g)(e.minimalOrderPrice.value)},function(e){var n=e.priceRangeRules.map((function(e,n){return{clientId:String(n+1),toPrice:Object(O.g)(e.toPrice.value),price:Object(O.g)(e.price.value)}}));return{priceRulesOrder:n.map(y.a.prop("clientId")),priceRules:n.reduce((function(e,n){return e[n.clientId]=n,e}),{})}}(e))}(e.zone)}));return r.a.useEffect((function(){t&&k&&a()}),[k,a,t]),r.a.useEffect((function(){P&&P.id!==E.state.values.id&&(E.api.mergeValues(P),E.state.pristineValues=Object(f.a)({},P))}),[P,E.api,E.state]),r.a.useEffect((function(){return function(){E.api.resetForm()}}),[E.api,t]),r.a.createElement(p.b,{xform:E},n)};var I=y.a.omit(["__typename"]);function S(e){return{name:e.name,enabled:e.enabled,companyBranch:e.branchId,zoneColor:e.zoneColor,geoPolygon:e.geoPolygon,minimalOrderPrice:{value:Object(E.b)(e.minimalPrice)},priceRangeRules:e.priceRulesOrder.map((function(n,t){return a=e.priceRules[n],r=t===e.priceRulesOrder.length-1,{price:{value:Object(E.b)(a.price)},toPrice:{value:r?-1:Object(E.b)(a.toPrice)}};var a,r}))}}var k=t(61),P=t(1467),F=t(4),N=t(1424),R=t(18),L=t(241),M=t(14);function B(){var e=Object(F.a)(["\n    background-color: ",";\n    color: ",";\n  "]);return B=function(){return e},e}function T(){var e=Object(F.a)(["\n  "," font-size: 1.3rem;\n  white-space: nowrap;\n  padding: 0.2rem 0.5rem;\n"]);return T=function(){return e},e}var _=R.c.div(T(),(function(e){var n=e.isActive;return Object(R.b)(B(),n?M.a.green:M.a.greyLight,n?M.a.white:M.a.greyDark)})),V=function(e){var n=e.branch,t=e.isActive,a=void 0===t||t;return r.a.createElement(N.b,{getPixelPositionOffset:function(e,n){return{x:-e/2,y:-n/2}},mapPaneName:N.b.MARKER_LAYER,position:Object(L.b)(n.gps)},r.a.createElement(_,{isActive:a},n.name))};var Z=function(e){var n=e.points,t=e.type,a=e.color,i=e.priority,c=e.onFocus,o=r.a.useCallback((function(e){c&&(e.stop(),c())}),[c]);return r.a.createElement(N.c,{path:n.map(L.b),options:t===g.p.Return?{fillColor:"transparent",strokeWeight:3,strokeColor:a,zIndex:1e4-i}:{fillColor:a,fillOpacity:.3,strokeWeight:0,zIndex:5e3-i},editable:!1,draggable:!1,onDblClick:o})},A=function(e){var n=e.type,t=e.color,a=e.onChange,i=e.initialPoints,c=r.a.useRef(null),o=r.a.useRef([]),l=r.a.useCallback((function(){if(c.current){var e=c.current.getPath();a(e.getArray().map(L.d))}}),[a]),u=r.a.useCallback((function(e){c.current=e;var n=e.getPath();o.current.push(n.addListener("set_at",l),n.addListener("insert_at",l),n.addListener("remove_at",l))}),[l]),d=r.a.useCallback((function(){o.current.forEach((function(e){return e.remove()})),o.current.length=0,c.current=null}),[]),s=r.a.useRef(i),m=r.a.useMemo((function(){return s.current.map(L.b)}),[]);return r.a.createElement(N.c,{path:m,options:n===g.p.Return?{fillColor:"transparent",strokeWeight:5,strokeColor:t,zIndex:2e4}:{fillColor:t,fillOpacity:.1,strokeWeight:2,zIndex:2e4},editable:!0,draggable:!0,onDragEnd:l,onLoad:u,onUnmount:d})};function D(){return(0,Object(g.uc)({},{fetchPolicy:"cache-first"}).getStash)((function(e){return e.zoneColors}))||h.a}var W=t(429);function H(){return Object(C.b)().zone}function q(){var e=Object(C.b)().zone,n=e.branches.filter(e.branchFilterPredicate).map(y.b),t=0===n.length,a=Object(g.wc)({branches:n},{skip:t}),r=a.getStash,i=a.loading;return{zones:r((function(e){return e.zones})),loading:i}}var G=Object(k.b)((function(e){var n=e.zoneId,t=H(),i=function(e){var n=H(),t=q().zones,a=n.branches.filter(n.branchFilterPredicate),i=r.a.useCallback((function(e){return!n.hasBranchFilter||e===n.branchFilterId}),[n]),c=Object(k.c)({zoneId:e,zones:t});return Object(w.e)((function(){if(n.map.isReady&&c.zoneId&&c.zones){var e=c.zones.find(Object(y.c)(c.zoneId));if(e){var t=Object(W.getCenter)(e.geoPolygon);n.map.panTo(t)}}})),Object(w.e)((function(){n.map.isReady&&n.branch&&!c.zoneId&&n.map.panTo(n.branch.gps)})),{isActive:i,branches:a,zones:t}}(n),c=i.isActive,o=i.branches,l=i.zones,u=z().routeToZoneEdit,d=Object(p.d)("geoPolygon"),s=Object(p.f)("type"),m=Object(p.f)("zoneColor"),f=D(),b=Object(a.useCallback)((function(e){return r.a.createElement(V,{key:"branch".concat(e.id),branch:e,isActive:c(e.id)})}),[c]);return r.a.createElement(P.a,{model:t.map},l&&l.map((function(e){return e.id===n?null:r.a.createElement(Z,{key:"zone".concat(e.id),type:e.zoneType.enum,points:e.geoPolygon,priority:e.priority,color:c(e.companyBranch.id)&&e.enabled&&null===n?e.zoneColor.color:M.a.greyMiddle,onFocus:function(){c(e.companyBranch.id)&&u(e.id)}})})),n&&function(){if(0===d.value.length)return null;var e=f.find(Object(y.c)(m.value));return r.a.createElement(A,{key:"zone".concat(n),type:s.value,color:e?e.color:"",initialPoints:d.value,onChange:d.setValue})}(),o&&o.map(b))})),U=t(466),J=t(1368),K=t(254),Q=t(1555),Y=t(1415),X=t(79),$=t(2797),ee=t(2798),ne=t(1372),te=t(1359),ae=t(1386),re=t(1522),ie=t(1554),ce=t(131),oe=t(160),le=t(1363),ue=t(1527),de=Object(k.b)((function(e,n){var t=e.fieldName,a=e.validate,i=Object(ae.b)({fieldName:t,validate:a})();return r.a.createElement(r.a.Fragment,null,r.a.createElement("label",{className:"forPriceLabel",htmlFor:i.id},l.b._({id:"for"})),r.a.createElement(le.b,Object.assign({},i,{className:"forPrice",ref:n,inputFullWidth:!0})),r.a.createElement(ue.a,{fieldName:"currencyCode"}))}),{forwardRef:!0}),se=Object(k.b)((function(e,n){var t=e.fieldName,a=e.validate,i=e.asInfinity,c=void 0!==i&&i,o=Object(ae.b)({fieldName:t,validate:a})(),u=Object(f.a)({},o,{className:"toPrice",ref:n}),d=r.a.createElement("label",{className:"toPriceLabel",htmlFor:o.id},l.b._({id:"to"}));return c?r.a.createElement(r.a.Fragment,null,d,r.a.createElement(le.b,Object.assign({},u,{value:"",disabled:!0,placeholder:"\u221e"}))):r.a.createElement(r.a.Fragment,null,d,r.a.createElement(le.b,u),r.a.createElement(ue.a,{fieldName:"currencyCode"}))}),{forwardRef:!0}),me=Object(k.b)((function(e){var n=e.fieldPath,t=e.shouldFocus,a=e.isLastRule,i=r.a.useRef(null),c=r.a.useRef(null),o=r.a.useCallback((function(e){if(isNaN(Object(E.b)(e)))return l.b._("Zone price rules cannot have empty values.")}),[]);return r.a.useEffect((function(){t&&(i.current&&!a?i.current.focus():c.current&&c.current.focus())}),[t,a]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"toPriceField"},r.a.createElement("div",{className:"verticalLine"}),r.a.createElement(se,{fieldName:[].concat(Object(oe.a)(n),["toPrice"]),validate:o,ref:i,asInfinity:a})),r.a.createElement("div",{className:"forPriceField"},r.a.createElement(de,{fieldName:[].concat(Object(oe.a)(n),["price"]),validate:o,ref:c})))}));function fe(){var e=Object(F.a)(["\n  display: grid;\n\n  grid-template-columns: 4.5rem 7rem 8rem 4.5rem;\n\n  & input {\n    width: 4rem;\n    z-index: 1;\n  }\n  & label {\n    margin: ",";\n  }\n\n  & .minimalPriceField {\n    grid-column: 2;\n    display: flex;\n    align-items: center;\n  }\n  & .minimalPriceField span {\n    margin: ",";\n  }\n  & .addRule {\n    grid-column: 1;\n    justify-self: start;\n    align-self: center;\n    margin-bottom: 3rem;\n  }\n  & .toPriceField {\n    grid-column: 2;\n    display: flex;\n    align-items: center;\n    align-self: end;\n    position: relative;\n  }\n  & .toPriceField span {\n    margin: ",";\n  }\n  & .forPriceField {\n    grid-column: 3;\n    display: flex;\n    align-items: center;\n    align-self: center;\n    margin-bottom: 3rem;\n  }\n  & .forPriceField input {\n    color: ",";\n    width: 4rem;\n  }\n  & .forPriceField span {\n    margin: ",";\n  }\n  & .removeRule {\n    height: 5rem;\n    margin-bottom: 3rem;\n    grid-column: 4;\n    display: flex;\n    align-items: center;\n    justify-self: end;\n    align-self: center;\n  }\n  & .verticalLine {\n    width: 3px;\n    height: 8rem;\n    background: ",";\n    position: absolute;\n    top: -112px;\n    left: 62px;\n  }\n"]);return fe=function(){return e},e}var be=R.c.div(fe(),M.d.Middle,M.d.Middle,M.d.Middle,M.a.blue,M.d.Middle,M.a.greyMiddle),pe=function(){var e=Object(p.d)("priceRulesOrder"),n=Object(p.f)("priceRules"),t=Object(p.i)(),i=r.a.useState(null),c=Object(b.a)(i,2),o=c[0],u=c[1],d=r.a.useRef(e.value.length);r.a.useEffect((function(){d.current<e.value.length&&(d.current=e.value.length)}),[e.value]);return Object(k.g)((function(){return r.a.createElement(be,null,r.a.createElement("div",{className:"minimalPriceField"},r.a.createElement(se,{fieldName:["minimalPrice"]})),e.value.map((function(i,c,s){return r.a.createElement(a.Fragment,{key:i},r.a.createElement(ce.a,{className:"addRule",disabled:t.isSubmitting,width:M.d.ButtonHeight+M.d.DefaultSizeUnit,height:M.d.ButtonHeight+M.d.DefaultSizeUnit,onClick:function(){return function(t){var a=e.value.findIndex(y.a.equals(t)),r=String(++d.current);e.value.splice(a,0,r),n.value[r]={clientId:String(r),toPrice:null,price:null},u(r)}(i)},icon:ie.a,title:l.b._("Add another range")}),r.a.createElement(me,{fieldPath:["priceRules",i],shouldFocus:i===o,isLastRule:c===s.length-1}),r.a.createElement("div",{className:"removeRule"},r.a.createElement(Y.a,{onDelete:function(){return function(n){var t=e.value.findIndex(y.a.equals(n));e.value.splice(t,1)}(i)},title:l.b._("Remove price range"),disabled:s.length<=1})))})))}))},ve=t(1576),ge=function(e){var n=e.fieldName,t=D();return r.a.createElement(ve.a,{colors:t,isLoading:0===t.length,fieldName:n})};function he(){var e=Object(F.a)(["\n  margin: ",";\n  color: ",";\n\n  .description {\n    color: ",";\n    padding-bottom: 0.2rem;\n  }\n"]);return he=function(){return e},e}var Oe=R.c.div(he(),M.d.Middle,M.a.black,M.a.greyDark),Ee=function(e){var n=e.type;return r.a.createElement(Oe,null,r.a.createElement(te.a,{icon:$.a},r.a.createElement(ae.a,{fieldName:"name"})),r.a.createElement(te.a,{icon:ee.a},r.a.createElement(ge,{fieldName:"zoneColor"})),r.a.createElement(re.a,{fieldName:"enabled",label:l.b._("Is active").toLocaleLowerCase()}),n===g.p.Area&&r.a.createElement(r.a.Fragment,null,r.a.createElement(X.Trans,{id:"<0>Delivery cost</0><1>according order total cost</1>",components:[r.a.createElement(ne.a,{margin:"0.5rem 0 0 0"}),r.a.createElement("div",{className:"description"})]}),r.a.createElement(pe,null)))},je=t(1375),ye=t(1374),we=t(1430),Ce=function(){var e=Object(p.i)(),n=z().routeToZoneList;return Object(k.g)((function(){return r.a.createElement(ye.a,null,r.a.createElement(je.a,{widthGrowIndex:.4,padding:"0"},r.a.createElement(ce.a,{color:M.a.greyMiddle,text:l.b._("Back"),onClick:n,disabled:e.isSubmitting})),r.a.createElement(je.a,{widthGrowIndex:.4,padding:"0"},r.a.createElement(J.a,{mutationName:"updateZone"},r.a.createElement(we.a,null,r.a.createElement(X.Trans,{id:"Save zone"})))))}))};function ze(){var e=Object(F.a)(["\n  width: ",";\n  margin-top: ",";\n"]);return ze=function(){return e},e}var xe=R.c.div(ze(),M.d.ButtonHeight+M.d.DefaultSizeUnit,M.d.Middle),Ie=Object(k.b)((function(e){var n=e.zoneId,t=z().routeToZoneList,a=Object(g.qb)(),i=Object(b.a)(a,1)[0],c=r.a.useCallback((function(){return m.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=3;break}return e.next=3,m.a.awrap(i({zoneId:n}));case 3:t();case 4:case"end":return e.stop()}}))}),[i,t,n]),o=Object(p.i)(),u=Object(p.f)("type").value;return r.a.createElement(K.a,{padding:0},r.a.createElement(Ce,null),r.a.createElement(Ee,{type:u}),r.a.createElement(J.a,{mutationName:"destroyZone"},r.a.createElement(xe,null,r.a.createElement(Y.a,{disabled:o.isSubmitting,confirmText:l.b._("Remove zone {0}?",{0:o.values.name}),onDelete:c}))),r.a.createElement(U.b,{when:o.isDirty},(function(e){var n=e.isShow,t=e.handleOk,a=e.handleCancel;return r.a.createElement(Q.a,{isShow:n,confirmText:l.b._("Do you want to cancel changes for the zone?"),onConfirm:t,onCancel:a})})))})),Se=Object(k.b)((function(e){var n=e.children;return Object(C.b)().user.hasSingleBranch?null:n})),ke=t(1426),Pe=R.c.p.withConfig({displayName:"StyledZoneListSection",componentId:"sc-1tw7uij-0"})(["color:",";"],M.a.greyMiddle),Fe=function(e){return e.type===g.p.Return?r.a.createElement(Pe,null,r.a.createElement(X.Trans,{id:"Notification will be shown when driver enters one of these zones."})):null},Ne=t(257),Re=Object(k.b)((function(e){var n,t,a=e.type,i=H(),c=z().routeToZoneEdit,o=Object(g.pb)(),u=Object(b.a)(o,1)[0],d=Object(j.a)().enqueueSuccess,s=r.a.useState(!1),f=Object(b.a)(s,2),p=f[0],v=f[1],h=(n={},Object(Ne.a)(n,g.p.Area,l.b._("Create delivery zone for branch")),Object(Ne.a)(n,g.p.Return,l.b._("Create return zone for branch")),n),O=(t={},Object(Ne.a)(t,g.p.Area,M.a.turquoise),Object(Ne.a)(t,g.p.Return,M.a.greyMiddle),t),E=i.hasBranchFilter?h[a]:l.b._("Select branch to create zone");return r.a.createElement(ce.a,{text:E,onClick:function(){var e;return m.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:if(i.branch){n.next=2;break}return n.abrupt("return");case 2:return v(!0),n.next=5,m.a.awrap(u({type:a,branchId:i.branch.id,points:Object(L.a)({center:i.branch.gps,metersRadius:1e3,pointsCount:5})}));case 5:(e=n.sent)&&(d(l.b._("Zone has been created")),c(e.createZone.id));case 7:case"end":return n.stop()}}))},disabled:p||!i.hasBranchFilter,color:O[a],height:M.d.ButtonHeight+M.d.DefaultSizeUnit,textNextToIcon:!0,icon:ie.a})})),Le=t(1573),Me=t(1469),Be=t(1891),Te=t(183),_e=t.n(Te),Ve=t(1472),Ze=t(1528),Ae=t(438);function De(){var e=Object(F.a)(["\n  height: ",";\n"]);return De=function(){return e},e}function We(){var e=Object(F.a)(["\n  font-size: 0.875rem;\n"]);return We=function(){return e},e}function He(){var e=Object(F.a)(["\n  font-size: 1.125rem;\n  margin-top: 0.2rem;\n"]);return He=function(){return e},e}function qe(){var e=Object(F.a)(["\n  background: ",";\n"]);return qe=function(){return e},e}var Ge=Object(R.c)(K.a)(qe(),(function(e){var n=e.color;if(e.type===g.p.Area)return"";var t=_e()(n).alpha(.8).darken(.2),a=t.lighten(.4);return"repeating-linear-gradient(135deg, ".concat(t,", ").concat(t," 10px, ").concat(a," 10px, ").concat(a," 20px)")}));var Ue=R.c.div(He()),Je=R.c.div(We()),Ke=Object(R.c)(ye.a)(De(),M.d.ButtonHeight+M.d.DefaultSizeUnit),Qe=Object(Ve.b)((function(e){var n=e.zone,t=e.branch,a=e.type,i=e.onEdit;return r.a.createElement(Ge,{key:n.id,type:a,padding:0,color:n.enabled?n.zoneColor.color:M.a.greyMiddle,onClick:i},r.a.createElement(Ke,null,r.a.createElement(je.a,{fixedWidth:!0,padding:"0 0.5rem 0 0"},r.a.createElement(Ae.a,null,r.a.createElement(ce.a,{icon:Be.a}))),r.a.createElement(je.a,{widthGrowIndex:1},r.a.createElement(Ue,null,n.name," [P".concat(n.priority,"]")),r.a.createElement(Je,null,t.name)),r.a.createElement(je.a,{padding:"0"},r.a.createElement(Ze.a,null))))})),Ye=R.c.div.withConfig({displayName:"ZoneListContainerStyled",componentId:"sc-1j9qfbo-0"})(["margin-top:0.5rem;cursor:arrow;"]),Xe=Object(Ve.a)(Ye),$e=function(e){e.type;var n=e.onSort,t=e.children;return r.a.createElement(Xe,{onSortEnd:n,useDragHandle:!0,lockAxis:"y",lockToContainerEdges:!0},t)},en=y.a.sortWith([y.a.ascend(y.a.path(["companyBranch","name"])),y.a.descend(y.a.prop("priority"))]),nn=y.a.groupBy((function(e){return e.companyBranch.id})),tn=y.a.pathEq(["zoneType","enum"]);var an=Object(k.b)((function(e){var n=e.type,t=H(),i=z().routeToZoneEdit,c=function(e){var n=q(),t=n.zones,a=n.loading,i=r.a.useMemo((function(){return t?y.a.mapObjIndexed(en,nn(t.filter(tn(e)))):null}),[e,t]),c=Object(g.sb)(),o=Object(b.a)(c,1)[0],l=r.a.useCallback((function(e){var n=e.oldIndex,t=e.newIndex,a=e.collection;if(i){var r=i[a][n],c=n-t;o({zoneId:r.id,offset:c},{optimisticResponse:{__typename:"Mutation",updateZonePriority:[{__typename:"Zone",id:r.id,priority:r.priority+c}]}})}}),[i,o]);return{isLoading:a,zonesByBranch:i,onZoneSort:l}}(n),o=c.isLoading,l=c.zonesByBranch,u=c.onZoneSort;if(null===o)return r.a.createElement(Le.a,{primaryOpacity:.2,secondaryOpacity:.2});if(null===l)return r.a.createElement(Me.a,null,r.a.createElement(X.Trans,{id:"Select brand to see its zones"}));var d=t.root.user.filterBranches(t.branchFilterPredicate),s=function(e,t){return r.a.createElement(Qe,{key:e.id,type:n,zone:e,branch:d.find(Object(y.c)(e.companyBranch.id)),onEdit:function(){return i(e.id)},index:t,collection:e.companyBranch.id})};return r.a.createElement($e,{type:n,onSort:u},d.map((function(e){var n=l[e.id];return n?function(e,n){return r.a.createElement(a.Fragment,{key:e.id},r.a.createElement(Me.a,null,e.name),n.map(s))}(e,n):null})))})),rn=t(15),cn=t(1384),on=t(1423),ln=t(1574),un=Object(k.b)((function(){var e=Object(C.b)(),n=e.user,t=e.zone,a=n.branches,i=r.a.useCallback((function(e){return null===e?[]:n.branches.filter(y.a.pathEq(["brand","id"],e.id))}),[n.branches]);if(r.a.useEffect((function(){return Object(rn.autorun)((function(){1===a.length&&t.setBranchFilter(y.a.head(a))}))}),[a,t]),a.length<=1)return null;var c=1===n.brands.length?y.a.head(n.brands):null;return c&&t.setBrandFilter(c,i(t.brand)),r.a.createElement(r.a.Fragment,null,!c&&r.a.createElement(ln.a,{selectedBrand:t.brand,onSelection:function(e){null===e?t.clearBrandFilter():t.setBrandFilter(e,i(e))}}),!c&&r.a.createElement(cn.a,null),r.a.createElement(on.a,{branches:i(t.brand),selectedBranch:t.branch,autoFocus:Boolean(c),formatOptionLabel:y.a.prop("name"),isClearable:!0,onSingleSelection:function(e){e?t.setBranchFilter(e):t.clearBranchFilter()}}))}));function dn(){var e=Object(F.a)(["\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n\n  & div.header {\n    flex: 0 0 auto;\n  }\n\n  & div.zone-list {\n    flex: 1 1 0;\n  }\n\n  & h3 {\n    margin-top: 6rem;\n  }\n"]);return dn=function(){return e},e}var sn=R.c.div(dn()),mn=r.a.memo((function(){var e=H();return Object(ke.a)((function(n){e.setBranchFilter(n)})),Object(k.g)((function(){return r.a.createElement(sn,null,r.a.createElement("div",{className:"header"},r.a.createElement(Se,null,r.a.createElement(K.a,null,r.a.createElement(un,null)))),r.a.createElement("div",{className:"zone-list"},e.zoneTypes.map((function(e,n){return r.a.createElement("div",{className:"list".concat(n),key:e},e===g.p.Return&&r.a.createElement("h3",null,r.a.createElement(X.Trans,{id:"Service zones"})),r.a.createElement(J.a,{mutationName:"createZone"},r.a.createElement(Re,{type:e})),r.a.createElement(Fe,{type:e}),r.a.createElement(an,{type:e}))}))))}))})),fn=function(e){var n=e.match.params.zoneId||null,t=Boolean(n);return r.a.createElement(d.a,{pageTitle:l.b._("Delivery zones"),backRoute:o.a,useBackButton:!0},r.a.createElement(x,{zoneId:n},r.a.createElement(u.a,{widthInColumns:6,column:10,rowInMobile:2,withScrollArea:!0},t?r.a.createElement(Ie,{zoneId:n}):r.a.createElement(mn,null)),r.a.createElement(u.a,{widthInColumns:10,rowInMobile:1,forcePercentHeightInMobile:60},r.a.createElement(G,{zoneId:n}))))};t.d(n,"ZonesRouting",(function(){return bn}));var bn=function(){return r.a.createElement(i.e,null,r.a.createElement(i.c,{path:"".concat(o.f,"/:zoneId?"),component:fn}),r.a.createElement(i.c,{component:c.a}))};n.default=bn}}]);
//# sourceMappingURL=378.23e1ab1f.chunk.js.map