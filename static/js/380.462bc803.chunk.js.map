{"version":3,"sources":["atoms/CanMutate.tsx","atoms/ScrollArea.tsx","molecules/PageLayoutFullHeightItem.tsx","atoms/FlexRowSingle.tsx","atoms/FlexColumn.tsx","hooks/useDropdownFilter.ts","atoms/VerticalGap.tsx","components/forms/FormInput.tsx","components/forms/FormSubmitButton.tsx","molecules/TouchButtonDelete.tsx","hooks/useDropdownSingle.ts","atoms/BaseMap.tsx","atoms/CardListTitle.tsx","components/forms/FormDropdownSingle.tsx","components/forms/FormDisplayValue.tsx","atoms/DragHandle.tsx","atoms/ConfirmDialog.tsx","molecules/CompanyBrandDropdown.tsx","components/forms/useFormLoader.ts","components/ColorSelector.tsx","segments/zones/hooks/useZoneRouteControl.tsx","segments/zones/molecules/ZoneFormLoader.tsx","molecules/MapCompanyBranchMarker.tsx","segments/zones/atoms/ZoneMapArea.tsx","segments/zones/atoms/ZoneMapEditableArea.tsx","segments/zones/hooks/useZoneColors.ts","segments/zones/hooks/useZoneModel.ts","segments/zones/hooks/useZoneListQuery.ts","segments/zones/molecules/ZoneMap.tsx","segments/zones/hooks/useZoneMapControl.ts","segments/zones/atoms/ZoneFormForPrice.tsx","segments/zones/atoms/ZoneFormToPrice.tsx","segments/zones/atoms/ZoneFormRuleInputs.tsx","segments/zones/molecules/ZoneFormPriceRules.tsx","segments/zones/molecules/ZoneColorSelector.tsx","segments/zones/molecules/ZoneFormContent.tsx","segments/zones/molecules/ZoneFormControls.tsx","segments/zones/organisms/ZoneFormPanel.tsx","atoms/UserHasMultipleBranches.tsx","segments/zones/atoms/ZoneListSection.tsx","segments/zones/molecules/CreateZoneButton.tsx","segments/zones/atoms/ZoneListCard.tsx","segments/zones/atoms/ZoneListCardGroup.tsx","segments/zones/hooks/useZoneListControl.ts","segments/zones/molecules/ZoneList.tsx","segments/zones/organisms/ZoneFilter.tsx","segments/zones/organisms/ZoneMenuPanel.tsx","segments/zones/pages/ZonesOverviewPage.tsx","segments/zones/routes/ZoneMenuRouting.tsx"],"names":["CanMutate","observer","mutationName","children","useCanMutate","ScrollArea","styled","div","StyledPageLayoutFullHeightItem","mediaDesktop","props","undefined","widthInColumns","Spacing","LayoutGridCellMargin","column","row","mediaMobile","rowInMobile","forcePercentHeightInMobile","PageHeaderHeight","DefaultSizeUnit","PageLayoutFullHeightItem","withScrollArea","scrollAreaId","forceHeightInMobile","isMobile","useResponsive","id","Sizer","height","heightUnit","FlexRowSingle","flexWrap","justify","FlexColumn","fixedWidth","width","widthGrowIndex","padding","margin","useDropdownFilter","getOptionFilter","isSearchable","filterOption","React","useCallback","option","rawInput","length","data","toLocaleLowerCase","includes","VerticalGap","size","sizeUnit","displayName","FormInput","forwardRef","inputRef","fieldName","fullWidth","validate","addHiddenLabelWithPlaceholderText","withLabel","getInputProps","useFormInputProps","useObserver","inputFullWidth","ref","placeholder","hidden","htmlFor","state","useXFormState","useXFieldForInput","field","disabled","isSubmitting","invalid","touched","Boolean","error","FormSubmitButton","type","color","Colors","green","icon","isValid","ErrorOutline","iconSize","iconColor","red","className","cn","heartBeat","TouchButtonDelete","onDelete","confirmText","Delete","greyMiddle","onClick","ev","preventDefault","window","confirm","useDropdownSingle","options","selected","onSelectionChange","getOptionValue","value","useMemo","find","onChange","libraries","createContext","BaseMap","model","streetViewControl","mapTypeControl","fullscreenControl","user","useRoot","useLoadScript","version","googleMapsApiKey","appConfig","googleMapsApi","language","isLoaded","loadError","googleMapUrl","url","googleAvailable","Reflect","has","Sentry","withScope","scope","setExtras","captureException","zoom","center","onCenterChanged","updatePosition","onZoomChanged","updateZoom","onLoad","setMapRef","mapContainerStyle","borderRadius","Radiuses","Card","overflow","useGoogleMap","map","useGoogleMapOrig","Error","CardListTitle","h2","greyLight","black","FormDropdownSingle","idProp","selectProps","formState","useXField","dropdownProps","setValue","filterProps","onFocus","setTouched","hasError","isDisabled","FormDisplayValue","useXFieldState","StyledDragHandle","DragHandle","SortableHandle","Reorder","ConfirmDialog","isShow","onCancel","onConfirm","useEffect","brandName","RM","prop","CompanyBrandDropdown","brands","selectedBrand","onSelection","formatOptionLabel","getOptionLabel","isClearable","autoFocus","logger","useFormLoader","onSubmit","initialValues","loadValues","validationSchema","submitMessage","submitRedirectPath","history","useRouterContext","useSnackBar","enqueueSuccess","enqueueWarning","onSubmitSuccess","values","a","async","push","onSubmitFailed","errors","msg","hasLoaded","useRef","onReset","current","xform","useXForm","initialValidationEnabled","ignoreUnknownFieldsInValidation","onFormChanges","Promise","resolve","then","api","mergeValues","pristineValues","enableValidation","ColorOption","white","ColorSelector","colors","isLoading","styles","base","menu","maxWidth","defaultValue","head","code","useZoneRouteControl","getRouteToZone","zoneId","ROUTE_SETTINGS_ZONES","routeToZoneEdit","editZoneId","canQuery","routeToZoneList","ZoneFormLoader","useMZoneUpdate","zoneUpdate","useObjectValidation","yup","name","string","required","minimalPrice","validateAsNumberField","i18n","min","fieldIsPositiveNumberMsg","xformState","update","getWriteVariables","ZoneTypeEnum","Area","enabled","branchId","zoneColor","geoPolygon","priceRules","priceRulesOrder","currencyCode","skip","useQZoneForm","getStash","zone","zoneType","enum","branchWithCurrency","withoutTypeName","currency","formatPrice","minimalOrderPrice","indexedPriceRules","priceRangeRules","rule","idx","clientId","String","toPrice","price","reduce","acc","normalizePriceRules","normalizeZoneToValues","resetForm","omit","companyBranch","parseNumber","isLast","BranchNameStyled","isActive","css","greyDark","MapCompanyBranchMarker","branch","getPixelPositionOffset","x","y","mapPaneName","OverlayView","MARKER_LAYER","position","gpsToLatLng","gps","ZoneMapArea","points","priority","onAreaFocus","e","stop","path","Return","fillColor","strokeWeight","strokeColor","zIndex","fillOpacity","editable","draggable","onDblClick","ZoneMapEditableArea","initialPoints","polygonRef","listenersRef","onAreaChange","getPath","getArray","latLngToGps","polygon","addListener","onUnmount","forEach","lis","remove","initialPointsRef","initialPath","onDragEnd","useZoneColors","useQZoneColors","fetchPolicy","zoneColors","ARRAY_EMPTY","useZoneModel","useZoneListQuery","branches","filter","branchFilterPredicate","useQZoneList","loading","zones","ZoneMap","zoneModel","companyBranchId","hasBranchFilter","branchFilterId","source","useAsObservableSource","useAutorun","isReady","idPropEq","getCenter","panTo","useZoneMapControl","polygonField","typeField","colorField","renderBranchLabel","key","renderEditZone","ZoneFormForPrice","fieldInputProps","_","ZoneFormToPrice","asInfinity","inputProps","label","ZoneFormRuleInputs","fieldPath","shouldFocus","isLastRule","toPriceRef","forPriceRef","isNaN","focus","StyledZoneFormPriceRules","Middle","blue","ZoneFormPriceRules","rulesOrderField","rulesField","useState","focusId","setFocusId","idCounter","ruleId","rules","TouchButton","ButtonHeight","afterRule","findIndex","equals","splice","addRule","AddCircle","title","removeRule","ZoneColorSelector","StyledZoneFormContent","ZoneFormContent","IconLine","Label","ColorLens","Headline","ZoneFormControls","text","DeleteButtonContainer","ZoneFormPanel","useMZoneDelete","deleteZone","when","isDirty","handleOk","handleCancel","UserHasMultipleBranches","hasSingleBranch","StyledZoneListSection","p","ZoneListSection","CreateZoneButton","useMZoneCreate","createZone","setDisabled","createTextByType","colorByType","turquoise","generatePolygon","metersRadius","pointsCount","result","textNextToIcon","StyledZoneListCard","baseColor","Color","alpha","darken","lighterColor","lighten","ZoneNameStyled","ZoneDescriptionStyled","ZoneFlexRowStyled","ZoneListCard","SortableElement","onEdit","SizerButton","Edit","ZoneListContainerStyled","SortableZoneList","SortableContainer","ZoneListCardGroup","onSort","onSortEnd","useDragHandle","lockAxis","lockToContainerEdges","sortZones","sortWith","ascend","descend","groupByBranch","groupBy","isZoneType","pathEq","ZoneList","zonesByBranch","mapObjIndexed","useMZoneUpdatePriority","updatePriority","onZoneSort","oldIndex","newIndex","collection","offset","optimisticResponse","__typename","updateZonePriority","useZoneListControl","primaryOpacity","secondaryOpacity","root","filterBranches","renderZone","index","branchZones","renderBranch","ZoneFilter","getBrandBranches","brand","autorun","setBranchFilter","singleBrand","setBrandFilter","clearBrandFilter","CompanyBranchDropdown","selectedBranch","onSingleSelection","clearBranchFilter","StyledZoneMenuPanel","ZoneMenuPanel","memo","useAutorunWhenSingleBranch","zoneTypes","ZonesOverviewPage","match","params","isEditing","PageLayoutResponsive","pageTitle","backRoute","ROUTE_SETTINGS","useBackButton","ZonesRouting","component","NotFoundPage"],"mappings":"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","file":"static/js/380.462bc803.chunk.js","sourcesContent":["import { observer } from 'mobx-react-lite'\nimport React from 'react'\n\nimport { useCanMutate } from '../hooks/useAccessGuard'\nimport { NoAccess } from './NoAccess'\n\ninterface IProps {\n  mutationName: string\n}\n\nexport const CanMutate = observer<IProps>(({ mutationName, children }) => {\n  const canMutate = useCanMutate(mutationName)\n  return canMutate ? (\n    <>{children}</>\n  ) : (\n    <NoAccess>{`No access to mutation ${mutationName}`}</NoAccess>\n  )\n})\n","import styled from 'styled-components'\n\nexport const ScrollArea = styled.div`\n  overflow-y: auto;\n  -webkit-overflow-scrolling: touch;\n  height: 100%;\n`\n","import React from 'react'\nimport styled from 'styled-components/macro'\n\nimport { mediaDesktop, mediaMobile, useResponsive } from '../app/Responsive'\nimport { ScrollArea } from '../atoms/ScrollArea'\nimport { Sizer } from '../atoms/Sizer'\nimport { Spacing } from '../styling'\n\ninterface IPageLayoutFullHeightItemProps {\n  row?: number\n  column?: number\n  rowInMobile?: number\n  widthInColumns?: number\n  withScrollArea?: boolean\n  forcePercentHeightInMobile?: number\n  scrollAreaId?: string\n}\n\nconst gridColumnWidth: string = '6.22vw'\nconst gridColumnHeigth: string = '3.9375rem'\n\nconst leftPos = () => (props: IPageLayoutFullHeightItemProps) => {\n  if (props.column !== undefined) {\n    return (\n      'calc((' +\n      props.column +\n      ' * ' +\n      gridColumnWidth +\n      ') + ' +\n      Spacing.LayoutGridCellMargin +\n      ')'\n    )\n  } else {\n    return Spacing.LayoutGridCellMargin\n  }\n}\nconst widthComputed = () => (props: IPageLayoutFullHeightItemProps) => {\n  if (props.widthInColumns !== undefined) {\n    return (\n      'calc((' +\n      props.widthInColumns +\n      ' * ' +\n      gridColumnWidth +\n      ') - ' +\n      Spacing.LayoutGridCellMargin +\n      ')'\n    )\n  } else {\n    return 'calc(100vh - (2 * ' + Spacing.LayoutGridCellMargin + '))'\n  }\n}\nconst topPos = () => (props: IPageLayoutFullHeightItemProps) => {\n  if (props.row !== undefined) {\n    return (\n      'calc((' +\n      props.row +\n      ' * ' +\n      gridColumnHeigth +\n      ') + ' +\n      Spacing.LayoutGridCellMargin +\n      ')'\n    )\n  } else {\n    return (\n      'calc(' + gridColumnHeigth + ' + ' + Spacing.LayoutGridCellMargin + ')'\n    )\n  }\n}\n\n// eslint-disable-next-line no-unexpected-multiline\nconst StyledPageLayoutFullHeightItem = styled.div<\n  IPageLayoutFullHeightItemProps\n>`\n  ${mediaDesktop`\n  position: fixed;\n  bottom: 0.5rem;\n  width: ${widthComputed()};\n  left: ${leftPos()};\n  top: ${topPos()};`}\n\n  ${mediaMobile`\n    margin: 0;\n    grid-row: ${({ rowInMobile }: IPageLayoutFullHeightItemProps) =>\n      rowInMobile} ;\n    grid-column: span 16;\n    height: ${({\n      forcePercentHeightInMobile,\n    }: IPageLayoutFullHeightItemProps) =>\n      forcePercentHeightInMobile\n        ? `calc(${forcePercentHeightInMobile}vh - ${Spacing.PageHeaderHeight +\n            0.25 +\n            Spacing.DefaultSizeUnit})`\n        : 'unset'} ;\n    position: relative;\n  `}\n`\n\nexport const PageLayoutFullHeightItem: React.FC<\n  IPageLayoutFullHeightItemProps\n> = ({\n  children,\n  row = 1,\n  rowInMobile = 16,\n  column = 0,\n  widthInColumns = 16,\n  withScrollArea = false,\n  scrollAreaId,\n  forcePercentHeightInMobile: forceHeightInMobile,\n}) => {\n  const { isMobile } = useResponsive()\n\n  return (\n    <StyledPageLayoutFullHeightItem\n      column={column}\n      row={row}\n      rowInMobile={rowInMobile}\n      widthInColumns={widthInColumns}\n      withScrollArea={withScrollArea}\n      forcePercentHeightInMobile={forceHeightInMobile}\n    >\n      {withScrollArea && !isMobile ? (\n        <ScrollArea id={scrollAreaId}>{children}</ScrollArea>\n      ) : (\n        <Sizer height={100} heightUnit=\"%\">\n          {children}\n        </Sizer>\n      )}\n    </StyledPageLayoutFullHeightItem>\n  )\n}\n","import styled from 'styled-components'\n\ninterface IProps {\n  flexWrap?: string\n  justify?: string\n}\n\nexport const FlexRowSingle = styled.div<IProps>`\n  display: flex;\n  flex-direction: row;\n  flex-wrap: ${({ flexWrap = 'unset' }: IProps) => flexWrap};\n  justify-content: ${({ justify = 'space-between' }: IProps) => justify};\n`\n","import styled from 'styled-components'\n\ninterface IFlexColumnProps {\n  fixedWidth?: boolean\n  width?: string\n  widthGrowIndex?: number\n  padding?: string\n  margin?: string\n}\n\nexport const FlexColumn = styled.div`\n  flex: ${getFlexValue};\n  padding: ${getPadding};\n  margin: ${getMargin};\n`\n\nfunction getFlexValue({\n  fixedWidth = false,\n  width,\n  widthGrowIndex = 0,\n}: IFlexColumnProps) {\n  return fixedWidth ? (width ? `0 0 ${width}` : '0 0') : `${widthGrowIndex} 0`\n}\n\nfunction getPadding({ padding = '0.25rem' }: IFlexColumnProps) {\n  return padding\n}\n\nfunction getMargin({ margin = '' }: IFlexColumnProps) {\n  return margin\n}\n","import React from 'react'\n\ntype TOptions<TSelectOption> = {\n  getOptionFilter?(option: TSelectOption): string\n}\n\nexport function useDropdownFilter<TSelectOption>({\n  getOptionFilter,\n}: TOptions<TSelectOption>) {\n  const isSearchable = typeof getOptionFilter === 'function'\n\n  const filterOption = React.useCallback(\n    (option, rawInput) => {\n      if (!getOptionFilter || rawInput.length === 0) {\n        return true\n      }\n      return getOptionFilter(option.data)\n        .toLocaleLowerCase()\n        .includes(rawInput.toLocaleLowerCase())\n    },\n    [getOptionFilter],\n  )\n\n  return { filterOption, isSearchable }\n}\n","import styled from 'styled-components'\n\ninterface IVerticalGapProps {\n  size?: number\n  sizeUnit?: string\n}\n\nexport const VerticalGap = styled.div`\n  height: ${({ size = 1, sizeUnit = 'rem' }: IVerticalGapProps) =>\n    `${size}${sizeUnit}`};\n`\n\nVerticalGap.displayName = 'VerticalGap'\n","import {\n  useXFieldForInput,\n  useXFormState,\n  XFieldName,\n  XFieldValidator,\n} from '@speedlo/xform'\nimport { useObserver } from 'mobx-react-lite'\nimport React from 'react'\n\nimport { StyledFormInput } from '../../atoms/FormInputStyled'\n\ntype TProps = NoChildren &\n  Omit<React.InputHTMLAttributes<never>, 'name'> & {\n    fieldName: XFieldName\n    validate?: XFieldValidator<string>\n    fullWidth?: boolean\n    addHiddenLabelWithPlaceholderText?: boolean\n  }\n\nexport type FormInputProps = TProps\n\nexport const FormInput = React.forwardRef<HTMLInputElement, TProps>(\n  (\n    {\n      fieldName,\n      fullWidth,\n      validate,\n      addHiddenLabelWithPlaceholderText: withLabel = true,\n      ...props\n    },\n    inputRef,\n  ) => {\n    const getInputProps = useFormInputProps({ fieldName, validate })\n    return useObserver(() => (\n      <>\n        <StyledFormInput\n          {...getInputProps()}\n          inputFullWidth={fullWidth}\n          ref={inputRef}\n          {...props}\n        />\n        {withLabel && props.placeholder && (\n          <label hidden={true} htmlFor={getInputProps().id}>\n            {props.placeholder}\n          </label>\n        )}\n      </>\n    ))\n  },\n)\n\ninterface IHookOptions {\n  fieldName: XFieldName\n  validate?: XFieldValidator<string>\n}\n\nexport function useFormInputProps({ fieldName, validate }: IHookOptions) {\n  const state = useXFormState()\n  const [field, getInputProps] = useXFieldForInput<string>(fieldName, {\n    validate,\n  })\n  return () => ({\n    ...getInputProps(),\n    disabled: state.isSubmitting,\n    invalid: field.touched && Boolean(field.error),\n  })\n}\n","import { ErrorOutline } from '@material-ui/icons'\nimport { cn } from '@speedlo/ui'\nimport { useXFormState } from '@speedlo/xform'\nimport { useObserver } from 'mobx-react-lite'\nimport React from 'react'\n\nimport { ITouchButtonProps, TouchButton } from '../../molecules/TouchButton'\nimport { Colors } from '../../styling'\n\ninterface IProps extends ITouchButtonProps {\n  children: ReactNode | ReactNode[] | string\n}\n\nexport const FormSubmitButton: React.FC<IProps> = ({\n  children,\n  id = 'form-submit',\n  ...props\n}) => {\n  const state = useXFormState()\n  return useObserver(() => (\n    <TouchButton\n      id={id}\n      type=\"submit\"\n      color={Colors.green}\n      disabled={state.isSubmitting}\n      icon={!state.isValid ? ErrorOutline : undefined}\n      iconSize={1.1}\n      iconColor={Colors.red}\n      {...props}\n      className={cn(props.className, 'animated', 'infinite', {\n        heartBeat: state.isSubmitting,\n      })}\n    >\n      <>{children}</>\n    </TouchButton>\n  ))\n}\n","import { Delete } from '@material-ui/icons'\nimport React from 'react'\n\nimport { SizerButton } from '../atoms/SizerButton'\nimport { Colors } from '../styling'\nimport { ITouchButtonProps, TouchButton } from './TouchButton'\n\ninterface ITouchButtonDeleteProps extends Omit<ITouchButtonProps, 'onClick'> {\n  confirmText?: string\n  onDelete(): void\n}\n\nexport const TouchButtonDelete: React.FC<ITouchButtonDeleteProps> = ({\n  onDelete,\n  confirmText,\n  ...props\n}) => {\n  return (\n    <SizerButton>\n      <TouchButton\n        className=\"delete-button\"\n        icon={Delete}\n        color={Colors.greyMiddle}\n        onClick={ev => {\n          ev.preventDefault()\n          if (!confirmText || window.confirm(confirmText)) {\n            onDelete()\n          }\n        }}\n        {...props}\n      />\n    </SizerButton>\n  )\n}\n","import React from 'react'\n\ntype TOptions<TSelectOption> = {\n  options: RoA<TSelectOption> | null\n  selected: MaybeID\n  onSelectionChange: (selected: MaybeID) => void\n  getOptionValue(option: TSelectOption): string\n}\n\nexport function useDropdownSingle<TSelectOption>({\n  options,\n  selected,\n  onSelectionChange,\n  getOptionValue,\n}: TOptions<TSelectOption>) {\n  const value = React.useMemo(() => {\n    if (selected === null) {\n      return null\n    }\n    return options === null\n      ? null\n      : options.find(option => getOptionValue(option) === selected) || null\n  }, [selected, options, getOptionValue])\n\n  const onChange = (option: unknown) => {\n    onSelectionChange(option ? getOptionValue(option as TSelectOption) : null)\n  }\n\n  return { value, onChange, getOptionValue }\n}\n","import { Trans } from '@lingui/macro'\nimport {\n  GoogleMap,\n  useGoogleMap as useGoogleMapOrig,\n  useLoadScript,\n} from '@react-google-maps/api'\nimport { Sentry } from '@speedlo/sentry'\nimport { Observer } from 'mobx-react-lite'\nimport React, { useContext } from 'react'\n\nimport { appConfig } from '../config'\nimport { TMapModel } from '../models/MapModel'\nimport { Radiuses } from '../styling'\nimport { useRoot } from './RootProvider'\n\ninterface IBaseMapProps {\n  model: TMapModel\n}\n\nconst mapModelContext = React.createContext<TMapModel | null>(null)\n\nconst libraries = ['places']\n\nexport const BaseMap: React.FC<IBaseMapProps> = ({ model, children }) => {\n  const options: google.maps.MapOptions = {\n    streetViewControl: false,\n    mapTypeControl: false,\n    fullscreenControl: false,\n  }\n\n  const { user } = useRoot()\n  const { isLoaded, loadError, url: googleMapUrl } = useLoadScript({\n    id: 'script-loader',\n    version: 'weekly',\n    googleMapsApiKey: appConfig.googleMapsApi,\n    libraries,\n    language: user.language!,\n  })\n\n  const renderMap = () => (\n    <Observer>\n      {() => (\n        <GoogleMap\n          zoom={model.zoom}\n          center={model.center}\n          onCenterChanged={model.updatePosition}\n          onZoomChanged={model.updateZoom}\n          onLoad={model.setMapRef}\n          options={options}\n          mapContainerStyle={{\n            borderRadius: Radiuses.Card,\n            overflow: 'hidden',\n            height: '100%',\n          }}\n        >\n          {children}\n        </GoogleMap>\n      )}\n    </Observer>\n  )\n\n  const googleAvailable = Reflect.has(window, 'google')\n\n  if (loadError || (isLoaded && !googleAvailable)) {\n    Sentry.withScope(scope => {\n      scope.setExtras({ googleMapUrl })\n      Sentry.captureException(loadError)\n    })\n    return (\n      <h2>\n        <Trans>Cannot load map right now. Please try again later.</Trans>\n      </h2>\n    )\n  }\n\n  return isLoaded ? renderMap() : null\n}\n\nexport function useMapModel() {\n  const model = useContext(mapModelContext)\n  if (!model) {\n    throw new Error('Trying to useMapModel, but BaseMap is missing in the tree')\n  }\n  return model\n}\n\nexport function useGoogleMap() {\n  const map = useGoogleMapOrig()\n  if (!map) {\n    throw new Error(\n      'Trying to useGoogleMap, but BaseMap is missing in the tree',\n    )\n  }\n  return map\n}\n","import styled from 'styled-components/macro'\n\nimport { Colors } from '../styling'\n\nexport const CardListTitle = styled.h2`\n  color: ${Colors.greyLight};\n  font-weight: lighter;\n  font-size: 1.2rem;\n  margin: 0.8rem 0 0.8rem 0.3rem;\n  @media print {\n    color: ${Colors.black};\n  }\n`\n","import { useXField, useXFormState, XFieldName } from '@speedlo/xform'\nimport { useObserver } from 'mobx-react-lite'\nimport React from 'react'\n\nimport { SelectControl, TSelectControlProps } from '../../atoms/SelectControl'\nimport { useDropdownFilter } from '../../hooks/useDropdownFilter'\nimport { useDropdownSingle } from '../../hooks/useDropdownSingle'\nimport { idProp } from '../../tools/ramda'\n\ntype TFormDropdownSingleProps<OptionType> = Omit<\n  TSelectControlProps<OptionType>,\n  'value' | 'onChange' | 'isMulti'\n> & {\n  fieldName: XFieldName\n  options: RoA<OptionType>\n  getOptionFilter?(option: OptionType): string\n}\n\nexport const FormDropdownSingle = <TOption extends any>({\n  fieldName,\n  getOptionValue = idProp as any,\n  getOptionFilter,\n  ...selectProps\n}: TFormDropdownSingleProps<TOption>) => {\n  const formState = useXFormState()\n  const field = useXField<MaybeID>(fieldName)\n\n  return useObserver(function useBody() {\n    const dropdownProps = useDropdownSingle({\n      ...selectProps,\n      onSelectionChange: field.setValue,\n      selected: field.value,\n      getOptionValue,\n    })\n    const filterProps = useDropdownFilter({ getOptionFilter })\n\n    return (\n      <SelectControl<TOption>\n        {...dropdownProps}\n        {...filterProps}\n        {...selectProps}\n        onFocus={() => field.setTouched()}\n        invalid={field.touched && field.hasError}\n        isDisabled={formState.isSubmitting}\n      />\n    )\n  })\n}\n","import { useXFieldState, XFieldName } from '@speedlo/xform'\nimport { useObserver } from 'mobx-react-lite'\nimport React from 'react'\n\ntype TProps = NoChildren & {\n  fieldName: XFieldName\n  className?: string\n}\n\nexport const FormDisplayValue: React.FC<TProps> = ({\n  fieldName,\n  className,\n}) => {\n  const field = useXFieldState<string>(fieldName)\n  return useObserver(() => <span className={className}>{field.value}</span>)\n}\n","import { Reorder } from '@material-ui/icons'\nimport React from 'react'\nimport { SortableHandle } from 'react-sortable-hoc'\nimport styled from 'styled-components'\n\nimport { Icon } from './Icon'\n\ninterface IProps {}\n\nconst StyledDragHandle = styled.div`\n  padding: 1rem 0.4rem;\n  cursor: grab;\n`\nexport const DragHandle = SortableHandle<IProps>(() => (\n  <StyledDragHandle>\n    <Icon icon={Reorder} />\n  </StyledDragHandle>\n))\n","import React, { useEffect } from 'react'\n\ninterface IProps {\n  isShow: boolean\n  confirmText: string\n  onConfirm(): void\n  onCancel(): void\n}\n\nexport const ConfirmDialog: React.FC<IProps> = ({\n  isShow,\n  confirmText,\n  onCancel,\n  onConfirm,\n}) => {\n  useEffect(() => {\n    if (isShow) {\n      if (window.confirm(confirmText)) {\n        onConfirm()\n      } else {\n        onCancel()\n      }\n    }\n  }, [confirmText, isShow, onCancel, onConfirm])\n  return null\n}\n","import React from 'react'\n\nimport { useRoot } from '../atoms/RootProvider'\nimport { SelectControl, TSelectControlProps } from '../atoms/SelectControl'\nimport { FCompanyBranchBrand } from '../graph/generated'\nimport { useDropdownFilter } from '../hooks/useDropdownFilter'\nimport { i18n } from '../i18n'\nimport { idProp, RM } from '../tools/ramda'\n\ntype TBrand = FCompanyBranchBrand\n\ntype TProps = NoChildren &\n  TSelectControlProps<TBrand> & {\n    brands?: RoA<TBrand>\n    selectedBrand: Maybe<TBrand>\n    onSelection(brand: Maybe<TBrand>): void\n  }\n\nconst brandName = RM.prop('name')\n\nexport const CompanyBrandDropdown: React.FC<TProps> = ({\n  brands,\n  selectedBrand,\n  onSelection,\n  ...selectProps\n}) => {\n  const { user } = useRoot()\n\n  const filterProps = useDropdownFilter({\n    getOptionFilter: brandName,\n  })\n\n  return (\n    <SelectControl<TBrand>\n      placeholder={i18n.t`Select brand`}\n      options={brands || user.brands}\n      value={selectedBrand}\n      formatOptionLabel={brandName}\n      getOptionValue={idProp}\n      getOptionLabel={brandName}\n      onChange={value => onSelection(value as Maybe<TBrand>)}\n      isClearable={true}\n      autoFocus={true}\n      {...filterProps}\n      {...selectProps}\n    />\n  )\n}\n","import { useRouterContext } from '@speedlo/hooks'\nimport { TValidationSchema, useXForm, XFormErrors } from '@speedlo/xform'\nimport React from 'react'\n\nimport { logForm } from '../../helpers/logger'\nimport { useSnackBar } from '../../hooks/useSnackBar'\n\ninterface IOptions<TValues> {\n  initialValues: TValues\n  loadValues?(initialValues: TValues): Promise<Partial<TValues> | undefined>\n  onSubmit(values: TValues): Promise<any>\n  submitMessage?: string\n  submitRedirectPath?: string\n  validationSchema?: TValidationSchema\n}\n\nexport type TFormLoaderOptions<TValues = any> = IOptions<TValues>\n\nconst logger =\n  process.env.REACT_APP_STAGE !== 'prod' ? obj => logForm('%o', obj) : undefined\n\nexport function useFormLoader<TValues>({\n  onSubmit,\n  initialValues,\n  loadValues,\n  validationSchema,\n  submitMessage,\n  submitRedirectPath,\n}: IOptions<TValues>) {\n  const { history } = useRouterContext()\n  const { enqueueSuccess, enqueueWarning } = useSnackBar()\n\n  const onSubmitSuccess = React.useCallback(\n    async (values: TValues) => {\n      await onSubmit(values)\n      if (submitMessage) {\n        enqueueSuccess(submitMessage)\n      }\n      if (submitRedirectPath) {\n        history.push(submitRedirectPath)\n      }\n    },\n    [enqueueSuccess, history, onSubmit, submitMessage, submitRedirectPath],\n  )\n\n  const onSubmitFailed = React.useCallback(\n    (values: TValues, errors: XFormErrors) => {\n      for (const msg of errors.values()) {\n        if (msg) {\n          enqueueWarning(msg)\n        }\n      }\n    },\n    [enqueueWarning],\n  )\n\n  const hasLoaded = React.useRef(false)\n\n  const onReset = React.useCallback(() => {\n    hasLoaded.current = false\n  }, [])\n\n  const xform = useXForm<TValues>({\n    onSubmit: onSubmitSuccess,\n    onSubmitFailed,\n    onReset,\n    validationSchema,\n    initialValues,\n    initialValidationEnabled: loadValues === undefined,\n    ignoreUnknownFieldsInValidation: true,\n    onFormChanges: logger,\n  })\n\n  React.useEffect(() => {\n    if (!hasLoaded.current) {\n      if (loadValues) {\n        Promise.resolve(loadValues(xform.state.initialValues)).then(values => {\n          if (values) {\n            xform.api.mergeValues(values)\n            xform.state.pristineValues = xform.state.values\n          }\n          xform.api.enableValidation()\n        })\n      }\n      hasLoaded.current = true\n    }\n  }, [loadValues, xform])\n\n  return xform\n}\n","import { XFieldName } from '@speedlo/xform'\nimport React from 'react'\nimport styled from 'styled-components'\n\nimport { QZoneColorsZoneColors } from '../graph/generated'\nimport { Colors } from '../styling'\nimport { idProp, RM } from '../tools/ramda'\nimport { FormDropdownSingle } from './forms/FormDropdownSingle'\n\ninterface IProps {\n  fieldName: XFieldName\n  colors: RoA<TColor>\n  isLoading: boolean\n}\n\nexport type TColor = {\n  id: ID\n  color: string\n  code: string\n}\n\nconst ColorOption = styled.div`\n  background-color: ${({ color }: { color: string }) => color};\n  color: ${Colors.white};\n  width: 6rem;\n  padding: 0.4rem 1rem;\n  margin: 0;\n  height: 100%;\n`\n\nconst makeStyles = () => ({\n  option: base => ({\n    ...base,\n    padding: 0,\n    margin: 0,\n  }),\n  menu: base => ({\n    ...base,\n    width: '8rem',\n    maxWidth: '8rem',\n  }),\n})\n\nexport const ColorSelector: React.FC<IProps> = ({\n  fieldName,\n  colors,\n  isLoading,\n}) => {\n  return (\n    <FormDropdownSingle<QZoneColorsZoneColors>\n      fieldName={fieldName}\n      options={colors}\n      isLoading={isLoading}\n      width={8}\n      styles={makeStyles()}\n      defaultValue={RM.head(colors)}\n      getOptionValue={idProp}\n      formatOptionLabel={({ color, code }) => (\n        <ColorOption color={color}>{code}</ColorOption>\n      )}\n    />\n  )\n}\n","import { useRouterContext } from '@speedlo/hooks'\nimport React from 'react'\n\nimport { useRoot } from '../../../atoms/RootProvider'\nimport { ROUTE_SETTINGS_ZONES } from '../../settings/settings.routes'\n\nexport function useZoneRouteControl() {\n  const { user } = useRoot()\n  const { history } = useRouterContext()\n  const getRouteToZone = React.useCallback((zoneId: ID) => {\n    return `${ROUTE_SETTINGS_ZONES}/${zoneId}`\n  }, [])\n\n  return {\n    getRouteToZone,\n    routeToZoneEdit: React.useCallback(\n      (editZoneId: ID) => {\n        if (user.canQuery('zone')) {\n          history.push(getRouteToZone(editZoneId))\n        }\n      },\n      [getRouteToZone, history, user],\n    ),\n    routeToZoneList: React.useCallback(() => {\n      history.push(ROUTE_SETTINGS_ZONES)\n    }, [history]),\n  }\n}\n","import { useObjectValidation, XFormRender, XFormState } from '@speedlo/xform'\nimport React from 'react'\n\nimport { useFormLoader } from '../../../components/forms/useFormLoader'\nimport {\n  InputZoneUpdate,\n  useMZoneUpdate,\n  useQZoneForm,\n  ZoneTypeEnum,\n} from '../../../graph/generated'\nimport {\n  fieldIsPositiveNumberMsg,\n  validateAsNumberField,\n} from '../../../helpers/form'\nimport { formatPrice } from '../../../helpers/formats'\nimport { parseNumber } from '../../../helpers/numeral'\nimport { useSnackBar } from '../../../hooks/useSnackBar'\nimport { i18n } from '../../../i18n'\nimport { RM } from '../../../tools/ramda'\nimport { useZoneRouteControl } from '../hooks/useZoneRouteControl'\nimport {\n  TZoneFormPriceRule,\n  TZoneFormValues,\n  TZoneInForm,\n} from '../zones.types'\n\ninterface IProps {\n  zoneId: MaybeID\n}\n\nexport const ZoneFormLoader: React.FC<IProps> = ({ children, zoneId }) => {\n  const { routeToZoneList } = useZoneRouteControl()\n  const { enqueueSuccess } = useSnackBar()\n\n  const [zoneUpdate] = useMZoneUpdate()\n\n  const validationSchema = useObjectValidation(yup => ({\n    name: yup.string().required(),\n    minimalPrice: validateAsNumberField(i18n.t`Minimal price`).min(\n      0,\n      fieldIsPositiveNumberMsg(i18n.t`Minimal price`),\n    ),\n  }))\n\n  const xformState = React.useRef<XFormState<TZoneFormValues>>()\n\n  const onSubmit = React.useCallback(\n    async (values: TZoneFormValues) => {\n      const result = await zoneUpdate({\n        zoneId: values.id,\n        update: getWriteVariables(values),\n      })\n      if (result) {\n        // to reset isDirty and avoid goodbye trigger\n        xformState.current!.pristineValues = { ...values }\n        routeToZoneList()\n        enqueueSuccess(i18n.t`Zone has been updated`)\n      }\n    },\n    [enqueueSuccess, routeToZoneList, zoneUpdate],\n  )\n\n  const xform = useFormLoader({\n    initialValues: getInitialValues(),\n    onSubmit,\n    validationSchema,\n  })\n\n  xformState.current = xform.state\n\n  const skip = !zoneId\n  const { getStash, error } = useQZoneForm({ zoneId: zoneId! }, { skip })\n\n  const zone = getStash(data => normalizeZoneToValues(data.zone))\n\n  React.useEffect(() => {\n    if (zoneId && error) {\n      routeToZoneList()\n      return\n    }\n  }, [error, routeToZoneList, zoneId])\n\n  React.useEffect(() => {\n    if (zone && zone.id !== xform.state.values.id) {\n      xform.api.mergeValues(zone)\n      xform.state.pristineValues = { ...zone }\n    }\n  }, [zone, xform.api, xform.state])\n\n  React.useEffect(() => {\n    return () => {\n      xform.api.resetForm()\n    }\n  }, [xform.api, zoneId])\n\n  return <XFormRender xform={xform}>{children as ReactNodes}</XFormRender>\n}\n\nfunction getInitialValues(): TZoneFormValues {\n  return {\n    id: '',\n    type: ZoneTypeEnum.Area,\n    name: '',\n    enabled: true,\n    branchId: '',\n    zoneColor: '',\n    geoPolygon: [],\n    minimalPrice: '0',\n    priceRules: {},\n    priceRulesOrder: [],\n    currencyCode: '',\n  }\n}\n\nconst withoutTypeName = RM.omit(['__typename'])\n\nfunction normalizeZoneToValues(zone: TZoneInForm): TZoneFormValues {\n  return {\n    id: zone.id,\n    type: zone.zoneType.enum,\n    name: zone.name,\n    enabled: zone.enabled,\n    zoneColor: zone.zoneColor.id,\n    branchId: zone.branchWithCurrency.id,\n    geoPolygon: zone.geoPolygon.map(withoutTypeName),\n    currencyCode: zone.branchWithCurrency.currency.code,\n    minimalPrice: formatPrice(zone.minimalOrderPrice.value),\n    ...normalizePriceRules(zone),\n  }\n}\n\nfunction normalizePriceRules(zone: TZoneInForm) {\n  // it's neccessary to add temporary ID for the collection to be modified safely\n  const indexedPriceRules: TZoneFormPriceRule[] = zone.priceRangeRules.map(\n    (rule, idx) => ({\n      clientId: String(idx + 1),\n      toPrice: formatPrice(rule.toPrice.value),\n      price: formatPrice(rule.price.value),\n    }),\n  )\n  return {\n    priceRulesOrder: indexedPriceRules.map(RM.prop('clientId')),\n    priceRules: indexedPriceRules.reduce((acc, rule) => {\n      acc[rule.clientId] = rule\n      return acc\n    }, {}),\n  }\n}\n\nfunction getWriteVariables(values: TZoneFormValues): InputZoneUpdate {\n  return {\n    name: values.name,\n    enabled: values.enabled,\n    companyBranch: values.branchId,\n    zoneColor: values.zoneColor,\n    geoPolygon: values.geoPolygon,\n    minimalOrderPrice: {\n      value: parseNumber(values.minimalPrice),\n    },\n    priceRangeRules: values.priceRulesOrder.map((clientId, idx) =>\n      normalizePriceRuleToWrite(\n        values.priceRules[clientId],\n        idx === values.priceRulesOrder.length - 1,\n      ),\n    ),\n  }\n}\n\nfunction normalizePriceRuleToWrite(rule: TZoneFormPriceRule, isLast: boolean) {\n  return {\n    price: { value: parseNumber(rule.price) },\n    toPrice: { value: isLast ? -1 : parseNumber(rule.toPrice) },\n  }\n}\n","import { OverlayView } from '@react-google-maps/api'\nimport React from 'react'\nimport styled, { css } from 'styled-components'\n\nimport { FCompanyBranchFragment } from '../graph/generated'\nimport { gpsToLatLng } from '../helpers/gps'\nimport { Colors } from '../styling'\n\ninterface IProps {\n  branch: FCompanyBranchFragment\n  isActive?: boolean\n}\n\nconst BranchNameStyled = styled.div`\n  ${getColors} font-size: 1.3rem;\n  white-space: nowrap;\n  padding: 0.2rem 0.5rem;\n`\n\nexport const MapCompanyBranchMarker: React.FC<IProps> = ({\n  branch,\n  isActive = true,\n}) => (\n  <OverlayView\n    getPixelPositionOffset={(width, height) => ({\n      x: -(width / 2),\n      y: -(height / 2),\n    })}\n    mapPaneName={OverlayView.MARKER_LAYER}\n    position={gpsToLatLng(branch.gps)}\n  >\n    <BranchNameStyled isActive={isActive}>{branch.name}</BranchNameStyled>\n  </OverlayView>\n)\n\nfunction getColors({ isActive }: { isActive: boolean }) {\n  return css`\n    background-color: ${isActive ? Colors.green : Colors.greyLight};\n    color: ${isActive ? Colors.white : Colors.greyDark};\n  `\n}\n","import { Polygon } from '@react-google-maps/api'\nimport React from 'react'\n\nimport { ZoneTypeEnum } from '../../../graph/generated'\nimport { gpsToLatLng } from '../../../helpers/gps'\n\ninterface IZoneMapAreaProps {\n  points: RoA<GeoPoint>\n  type: ZoneTypeEnum\n  color: string\n  priority: number\n  onFocus?(): void\n}\n\nexport const ZoneMapArea: React.FC<IZoneMapAreaProps> = ({\n  points,\n  type,\n  color,\n  priority,\n  onFocus,\n}) => {\n  const onAreaFocus = React.useCallback(\n    (e: google.maps.PolyMouseEvent) => {\n      if (onFocus) {\n        e.stop()\n        onFocus()\n      }\n    },\n    [onFocus],\n  )\n\n  const getOptions = (): google.maps.PolygonOptions => {\n    if (type === ZoneTypeEnum.Return) {\n      return {\n        fillColor: 'transparent',\n        strokeWeight: 3,\n        strokeColor: color,\n        zIndex: 10000 - priority,\n      }\n    }\n    return {\n      fillColor: color,\n      fillOpacity: 0.3,\n      strokeWeight: 0,\n      zIndex: 5000 - priority,\n    }\n  }\n\n  return (\n    <Polygon\n      path={points.map(gpsToLatLng)}\n      options={getOptions()}\n      editable={false}\n      draggable={false}\n      onDblClick={onAreaFocus}\n    />\n  )\n}\n","import { Polygon } from '@react-google-maps/api'\nimport React from 'react'\n\nimport { ZoneTypeEnum } from '../../../graph/generated'\nimport { gpsToLatLng, latLngToGps } from '../../../helpers/gps'\n\ninterface IProps {\n  type: ZoneTypeEnum\n  color: string\n  initialPoints: RoA<GeoPoint>\n  onChange(points: GeoPoint[]): void\n}\n\nexport const ZoneMapEditableArea: React.FC<IProps> = ({\n  type,\n  color,\n  onChange,\n  initialPoints,\n}) => {\n  const polygonRef = React.useRef<google.maps.Polygon | null>(null)\n  const listenersRef = React.useRef<google.maps.MapsEventListener[]>([])\n\n  const onAreaChange = React.useCallback(() => {\n    if (polygonRef.current) {\n      const path = polygonRef.current.getPath()\n      onChange(path.getArray().map(latLngToGps))\n    }\n  }, [onChange])\n\n  const onLoad = React.useCallback(\n    (polygon: google.maps.Polygon) => {\n      polygonRef.current = polygon\n      const path = polygon.getPath()\n      listenersRef.current.push(\n        path.addListener('set_at', onAreaChange),\n        path.addListener('insert_at', onAreaChange),\n        path.addListener('remove_at', onAreaChange),\n      )\n    },\n    [onAreaChange],\n  )\n\n  const onUnmount = React.useCallback(() => {\n    listenersRef.current.forEach(lis => lis.remove())\n    listenersRef.current.length = 0\n    polygonRef.current = null\n  }, [])\n\n  const initialPointsRef = React.useRef(initialPoints)\n  const initialPath = React.useMemo(\n    () => initialPointsRef.current.map(gpsToLatLng),\n    [],\n  )\n\n  const getOptions = (): google.maps.PolygonOptions => {\n    if (type === ZoneTypeEnum.Return) {\n      return {\n        fillColor: 'transparent',\n        strokeWeight: 5,\n        strokeColor: color,\n        zIndex: 20000,\n      }\n    }\n    return {\n      fillColor: color,\n      fillOpacity: 0.1,\n      strokeWeight: 2,\n      zIndex: 20000,\n    }\n  }\n\n  return (\n    <Polygon\n      path={initialPath}\n      options={getOptions()}\n      editable={true}\n      draggable={true}\n      onDragEnd={onAreaChange}\n      onLoad={onLoad}\n      onUnmount={onUnmount}\n    />\n  )\n}\n","import { useQZoneColors } from '../../../graph/generated'\nimport { ARRAY_EMPTY } from '../../../helpers/form'\n\nexport function useZoneColors() {\n  const { getStash } = useQZoneColors({}, { fetchPolicy: 'cache-first' })\n  return getStash(data => data.zoneColors) || ARRAY_EMPTY\n}\n","import { useRoot } from '../../../atoms/RootProvider'\n\nexport function useZoneModel() {\n  const { zone: zoneModel } = useRoot()\n  return zoneModel\n}\n","import { useRoot } from '../../../atoms/RootProvider'\nimport { useQZoneList } from '../../../graph/generated'\nimport { idProp } from '../../../tools/ramda'\n\nexport function useZoneListQuery() {\n  const { zone } = useRoot()\n  const branches = zone.branches.filter(zone.branchFilterPredicate).map(idProp)\n  const skip = branches.length === 0\n\n  const { getStash, loading } = useQZoneList({ branches }, { skip })\n\n  const zones = getStash(data => data.zones)\n\n  return { zones, loading }\n}\n","import { useXField, useXFieldState } from '@speedlo/xform'\nimport { observer } from 'mobx-react-lite'\nimport React, { useCallback } from 'react'\n\nimport { BaseMap } from '../../../atoms/BaseMap'\nimport { FCompanyBranchFragment } from '../../../graph/generated'\nimport { MapCompanyBranchMarker } from '../../../molecules/MapCompanyBranchMarker'\nimport { Colors } from '../../../styling'\nimport { idPropEq } from '../../../tools/ramda'\nimport { ZoneMapArea } from '../atoms/ZoneMapArea'\nimport { ZoneMapEditableArea } from '../atoms/ZoneMapEditableArea'\nimport { useZoneColors } from '../hooks/useZoneColors'\nimport { useZoneMapControl } from '../hooks/useZoneMapControl'\nimport { useZoneModel } from '../hooks/useZoneModel'\nimport { useZoneRouteControl } from '../hooks/useZoneRouteControl'\nimport { TZoneFormValues, TZoneInList } from '../zones.types'\n\ninterface IProps {\n  zoneId: MaybeID\n}\n\nexport const ZoneMap = observer<IProps>(({ zoneId }) => {\n  const zoneModel = useZoneModel()\n\n  const { isActive, branches, zones } = useZoneMapControl(zoneId)\n  const { routeToZoneEdit } = useZoneRouteControl()\n\n  const renderZoneArea = (zone: TZoneInList) => {\n    if (zone.id === zoneId) {\n      return null\n    }\n\n    return (\n      <ZoneMapArea\n        key={`zone${zone.id}`}\n        type={zone.zoneType.enum}\n        points={zone.geoPolygon}\n        priority={zone.priority}\n        color={\n          isActive(zone.companyBranch.id) && zone.enabled && zoneId === null\n            ? zone.zoneColor.color\n            : Colors.greyMiddle\n        }\n        onFocus={() => {\n          if (isActive(zone.companyBranch.id)) {\n            routeToZoneEdit(zone.id)\n          }\n        }}\n      />\n    )\n  }\n\n  const polygonField = useXField<TZoneFormValues['geoPolygon']>('geoPolygon')\n  const typeField = useXFieldState<TZoneFormValues['type']>('type')\n  const colorField = useXFieldState<TZoneFormValues['zoneColor']>('zoneColor')\n  const zoneColors = useZoneColors()\n\n  const renderEditZone = () => {\n    if (polygonField.value.length === 0) {\n      return null\n    }\n    const zoneColor = zoneColors.find(idPropEq(colorField.value))\n    return (\n      <ZoneMapEditableArea\n        key={`zone${zoneId}`}\n        type={typeField.value}\n        color={zoneColor ? zoneColor.color : ''}\n        initialPoints={polygonField.value}\n        onChange={polygonField.setValue}\n      />\n    )\n  }\n\n  const renderBranchLabel = useCallback(\n    (branch: FCompanyBranchFragment) => (\n      <MapCompanyBranchMarker\n        key={`branch${branch.id}`}\n        branch={branch}\n        isActive={isActive(branch.id)}\n      />\n    ),\n    [isActive],\n  )\n\n  return (\n    <BaseMap model={zoneModel.map}>\n      {zones && zones.map(renderZoneArea)}\n      {zoneId && renderEditZone()}\n      {branches && branches.map(renderBranchLabel)}\n    </BaseMap>\n  )\n})\n","import { useAutorun } from '@speedlo/hooks'\nimport { getCenter } from 'geolib'\nimport { useAsObservableSource } from 'mobx-react-lite'\nimport React from 'react'\n\nimport { idPropEq } from '../../../tools/ramda'\nimport { useZoneModel } from '../hooks/useZoneModel'\nimport { useZoneListQuery } from './useZoneListQuery'\n\nexport function useZoneMapControl(zoneId: MaybeID) {\n  const zoneModel = useZoneModel()\n  const { zones } = useZoneListQuery()\n\n  const branches = zoneModel.branches.filter(zoneModel.branchFilterPredicate)\n\n  const isActive = React.useCallback(\n    (companyBranchId: ID) => {\n      return (\n        !zoneModel.hasBranchFilter ||\n        companyBranchId === zoneModel.branchFilterId\n      )\n    },\n    [zoneModel],\n  )\n\n  const source = useAsObservableSource({ zoneId, zones })\n\n  // when editing zone, pan map to branch with that zone\n  useAutorun(() => {\n    if (zoneModel.map.isReady && source.zoneId && source.zones) {\n      const zone = source.zones.find(idPropEq(source.zoneId))\n      if (zone) {\n        const center = getCenter(zone.geoPolygon as GeoPoint[])\n        zoneModel.map.panTo(center as GeoPoint)\n      }\n    }\n  })\n\n  // when branch changes and we are not editing zone, pan to branch gps\n  useAutorun(() => {\n    if (zoneModel.map.isReady && zoneModel.branch && !source.zoneId) {\n      zoneModel.map.panTo(zoneModel.branch.gps)\n    }\n  })\n\n  return { isActive, branches, zones }\n}\n","import { t } from '@lingui/macro'\nimport { XFieldName, XFieldValidator } from '@speedlo/xform'\nimport { observer } from 'mobx-react-lite'\nimport React from 'react'\n\nimport { StyledFormInput } from '../../../atoms/FormInputStyled'\nimport { FormDisplayValue } from '../../../components/forms/FormDisplayValue'\nimport { useFormInputProps } from '../../../components/forms/FormInput'\nimport { LocaleNumber } from '../../../helpers/numeral'\nimport { i18n } from '../../../i18n'\n\ninterface IProps {\n  fieldName: XFieldName\n  validate?: XFieldValidator<LocaleNumber>\n}\n\nexport const ZoneFormForPrice = observer<IProps, HTMLInputElement>(\n  ({ fieldName, validate }, ref) => {\n    const fieldInputProps = useFormInputProps({\n      fieldName,\n      validate,\n    })()\n\n    return (\n      <>\n        <label className=\"forPriceLabel\" htmlFor={fieldInputProps.id}>\n          {i18n._(\n            /*i18n: Label for input with transport fee used when zone rule applies */ t`for`,\n          )}\n        </label>\n        <StyledFormInput\n          {...fieldInputProps}\n          className=\"forPrice\"\n          ref={ref}\n          inputFullWidth={true}\n        />\n        <FormDisplayValue fieldName=\"currencyCode\" />\n      </>\n    )\n  },\n  { forwardRef: true },\n)\n","import { t } from '@lingui/macro'\nimport { XFieldName, XFieldValidator } from '@speedlo/xform'\nimport { observer } from 'mobx-react-lite'\nimport React from 'react'\n\nimport { StyledFormInput } from '../../../atoms/FormInputStyled'\nimport { FormDisplayValue } from '../../../components/forms/FormDisplayValue'\nimport { useFormInputProps } from '../../../components/forms/FormInput'\nimport { LocaleNumber } from '../../../helpers/numeral'\nimport { i18n } from '../../../i18n'\n\ninterface IProps {\n  fieldName: XFieldName\n  validate?: XFieldValidator<LocaleNumber>\n  asInfinity?: boolean\n}\n\nexport const ZoneFormToPrice = observer<IProps, HTMLInputElement>(\n  ({ fieldName, validate, asInfinity = false }, ref) => {\n    const fieldInputProps = useFormInputProps({\n      fieldName,\n      validate,\n    })()\n\n    const inputProps = {\n      ...fieldInputProps,\n      className: 'toPrice',\n      ref,\n    }\n\n    const label = (\n      <label className=\"toPriceLabel\" htmlFor={fieldInputProps.id}>\n        {i18n._(\n          /*i18n: Label for input with upper bound of order price where zone rule is applied */ t`to`,\n        )}\n      </label>\n    )\n\n    if (asInfinity) {\n      return (\n        <>\n          {label}\n          <StyledFormInput\n            {...inputProps}\n            value=\"\"\n            disabled\n            placeholder=\"&infin;\"\n          />\n        </>\n      )\n    }\n\n    return (\n      <>\n        {label}\n        <StyledFormInput {...inputProps} />\n        <FormDisplayValue fieldName=\"currencyCode\" />\n      </>\n    )\n  },\n  { forwardRef: true },\n)\n","import { XFieldPath } from '@speedlo/xform'\nimport { observer } from 'mobx-react-lite'\nimport React from 'react'\n\nimport { parseNumber } from '../../../helpers/numeral'\nimport { i18n } from '../../../i18n'\nimport { ZoneFormForPrice } from './ZoneFormForPrice'\nimport { ZoneFormToPrice } from './ZoneFormToPrice'\n\ninterface IProps {\n  fieldPath: XFieldPath\n  shouldFocus: boolean\n  isLastRule: boolean\n}\n\nexport const ZoneFormRuleInputs = observer<IProps>(\n  ({ fieldPath, shouldFocus, isLastRule }) => {\n    const toPriceRef = React.useRef<HTMLInputElement>(null)\n    const forPriceRef = React.useRef<HTMLInputElement>(null)\n\n    const validate = React.useCallback(value => {\n      if (isNaN(parseNumber(value))) {\n        return i18n.t`Zone price rules cannot have empty values.`\n      }\n      return\n    }, [])\n\n    React.useEffect(() => {\n      if (!shouldFocus) {\n        return\n      }\n      if (toPriceRef.current && !isLastRule) {\n        toPriceRef.current.focus()\n      } else if (forPriceRef.current) {\n        forPriceRef.current.focus()\n      }\n    }, [shouldFocus, isLastRule])\n\n    return (\n      <>\n        <div className=\"toPriceField\">\n          <div className=\"verticalLine\"></div>\n          <ZoneFormToPrice\n            fieldName={[...fieldPath, 'toPrice']}\n            validate={validate}\n            ref={toPriceRef}\n            asInfinity={isLastRule}\n          />\n        </div>\n        <div className=\"forPriceField\">\n          <ZoneFormForPrice\n            fieldName={[...fieldPath, 'price']}\n            validate={validate}\n            ref={forPriceRef}\n          />\n        </div>\n      </>\n    )\n  },\n)\n","import { AddCircle } from '@material-ui/icons'\nimport { useXField, useXFieldState, useXFormState } from '@speedlo/xform'\nimport { useObserver } from 'mobx-react-lite'\nimport React, { Fragment } from 'react'\nimport styled from 'styled-components'\n\nimport { i18n } from '../../../i18n'\nimport { TouchButton } from '../../../molecules/TouchButton'\nimport { TouchButtonDelete } from '../../../molecules/TouchButtonDelete'\nimport { Colors, Spacing } from '../../../styling'\nimport { RM } from '../../../tools/ramda'\nimport { ZoneFormRuleInputs } from '../atoms/ZoneFormRuleInputs'\nimport { ZoneFormToPrice } from '../atoms/ZoneFormToPrice'\nimport { TZoneFormValues } from '../zones.types'\n\ninterface IProps {}\n\nconst StyledZoneFormPriceRules = styled.div`\n  display: grid;\n\n  grid-template-columns: 4.5rem 7rem 8rem 4.5rem;\n\n  & input {\n    width: 4rem;\n    z-index: 1;\n  }\n  & label {\n    margin: ${Spacing.Middle};\n  }\n\n  & .minimalPriceField {\n    grid-column: 2;\n    display: flex;\n    align-items: center;\n  }\n  & .minimalPriceField span {\n    margin: ${Spacing.Middle};\n  }\n  & .addRule {\n    grid-column: 1;\n    justify-self: start;\n    align-self: center;\n    margin-bottom: 3rem;\n  }\n  & .toPriceField {\n    grid-column: 2;\n    display: flex;\n    align-items: center;\n    align-self: end;\n    position: relative;\n  }\n  & .toPriceField span {\n    margin: ${Spacing.Middle};\n  }\n  & .forPriceField {\n    grid-column: 3;\n    display: flex;\n    align-items: center;\n    align-self: center;\n    margin-bottom: 3rem;\n  }\n  & .forPriceField input {\n    color: ${Colors.blue};\n    width: 4rem;\n  }\n  & .forPriceField span {\n    margin: ${Spacing.Middle};\n  }\n  & .removeRule {\n    height: 5rem;\n    margin-bottom: 3rem;\n    grid-column: 4;\n    display: flex;\n    align-items: center;\n    justify-self: end;\n    align-self: center;\n  }\n  & .verticalLine {\n    width: 3px;\n    height: 8rem;\n    background: ${Colors.greyMiddle};\n    position: absolute;\n    top: -112px;\n    left: 62px;\n  }\n`\n\nexport const ZoneFormPriceRules: React.FC<IProps> = () => {\n  const rulesOrderField = useXField<TZoneFormValues['priceRulesOrder']>(\n    'priceRulesOrder',\n  )\n  const rulesField = useXFieldState<TZoneFormValues['priceRules']>('priceRules')\n  const state = useXFormState()\n\n  const [focusId, setFocusId] = React.useState<MaybeID>(null)\n\n  // artificial ID for a dynamic changes of array\n  const idCounter = React.useRef(rulesOrderField.value.length)\n\n  React.useEffect(() => {\n    if (idCounter.current < rulesOrderField.value.length) {\n      idCounter.current = rulesOrderField.value.length\n    }\n  }, [rulesOrderField.value])\n\n  const addRule = (afterRule: ID) => {\n    const idx = rulesOrderField.value.findIndex(RM.equals(afterRule))\n    const ruleId = String(++idCounter.current)\n    rulesOrderField.value.splice(idx, 0, ruleId)\n    rulesField.value[ruleId] = {\n      clientId: String(ruleId),\n      toPrice: null,\n      price: null,\n    }\n    setFocusId(ruleId)\n  }\n\n  const removeRule = (rule: ID) => {\n    const idx = rulesOrderField.value.findIndex(RM.equals(rule))\n    rulesOrderField.value.splice(idx, 1)\n  }\n\n  return useObserver(() => (\n    <StyledZoneFormPriceRules>\n      <div className=\"minimalPriceField\">\n        <ZoneFormToPrice fieldName={['minimalPrice']} />\n      </div>\n      {rulesOrderField.value.map((ruleId, idx, rules) => (\n        <Fragment key={ruleId}>\n          <TouchButton\n            className=\"addRule\"\n            disabled={state.isSubmitting}\n            width={Spacing.ButtonHeight + Spacing.DefaultSizeUnit}\n            height={Spacing.ButtonHeight + Spacing.DefaultSizeUnit}\n            onClick={() => addRule(ruleId)}\n            icon={AddCircle}\n            title={i18n.t`Add another range`}\n          />\n          <ZoneFormRuleInputs\n            fieldPath={['priceRules', ruleId]}\n            shouldFocus={ruleId === focusId}\n            isLastRule={idx === rules.length - 1}\n          />\n          <div className=\"removeRule\">\n            <TouchButtonDelete\n              onDelete={() => removeRule(ruleId)}\n              title={i18n.t`Remove price range`}\n              disabled={rules.length <= 1}\n            />\n          </div>\n        </Fragment>\n      ))}\n    </StyledZoneFormPriceRules>\n  ))\n}\n","import { XFieldName } from '@speedlo/xform'\nimport React from 'react'\n\nimport { ColorSelector } from '../../../components/ColorSelector'\nimport { useZoneColors } from '../hooks/useZoneColors'\n\ninterface IProps {\n  fieldName: XFieldName\n}\n\nexport const ZoneColorSelector: React.FC<IProps> = ({ fieldName }) => {\n  const zoneColors = useZoneColors()\n  return (\n    <ColorSelector\n      colors={zoneColors}\n      isLoading={zoneColors.length === 0}\n      fieldName={fieldName}\n    />\n  )\n}\n","import { Trans } from '@lingui/macro'\nimport { ColorLens, Label } from '@material-ui/icons'\nimport React from 'react'\nimport styled from 'styled-components'\n\nimport { Headline } from '../../../atoms/Headline'\nimport { IconLine } from '../../../atoms/IconLine'\nimport { FormInput } from '../../../components/forms/FormInput'\nimport { FormCheckbox } from '../../../components/forms/FormInputCheckbox'\nimport { ZoneTypeEnum } from '../../../graph/generated'\nimport { i18n } from '../../../i18n'\nimport { Colors, Spacing } from '../../../styling'\nimport { ZoneFormPriceRules } from '../molecules/ZoneFormPriceRules'\nimport { ZoneColorSelector } from './ZoneColorSelector'\n\ninterface IProps {\n  type: ZoneTypeEnum\n}\n\nconst StyledZoneFormContent = styled.div`\n  margin: ${Spacing.Middle};\n  color: ${Colors.black};\n\n  .description {\n    color: ${Colors.greyDark};\n    padding-bottom: 0.2rem;\n  }\n`\n\nexport const ZoneFormContent: React.FC<IProps> = ({ type }) => (\n  <StyledZoneFormContent>\n    <IconLine icon={Label}>\n      <FormInput fieldName=\"name\" />\n    </IconLine>\n\n    <IconLine icon={ColorLens}>\n      <ZoneColorSelector fieldName=\"zoneColor\" />\n    </IconLine>\n\n    <FormCheckbox\n      fieldName=\"enabled\"\n      label={i18n.t`Is active`.toLocaleLowerCase()}\n    />\n\n    {type === ZoneTypeEnum.Area && (\n      <>\n        <Trans>\n          <Headline margin=\"0.5rem 0 0 0\">Delivery cost</Headline>\n          <div className=\"description\">according order total cost</div>\n        </Trans>\n\n        <ZoneFormPriceRules />\n      </>\n    )}\n  </StyledZoneFormContent>\n)\n","import { Trans } from '@lingui/macro'\nimport { useXFormState } from '@speedlo/xform'\nimport { useObserver } from 'mobx-react-lite'\nimport React from 'react'\n\nimport { CanMutate } from '../../../atoms/CanMutate'\nimport { FlexColumn } from '../../../atoms/FlexColumn'\nimport { FlexRowSingle } from '../../../atoms/FlexRowSingle'\nimport { FormSubmitButton } from '../../../components/forms/FormSubmitButton'\nimport { i18n } from '../../../i18n'\nimport { TouchButton } from '../../../molecules/TouchButton'\nimport { Colors } from '../../../styling'\nimport { useZoneRouteControl } from '../hooks/useZoneRouteControl'\n\ninterface IProps {}\n\nexport const ZoneFormControls: React.FC<IProps> = () => {\n  const state = useXFormState()\n  const { routeToZoneList } = useZoneRouteControl()\n  return useObserver(() => (\n    <FlexRowSingle>\n      <FlexColumn widthGrowIndex={0.4} padding=\"0\">\n        <TouchButton\n          color={Colors.greyMiddle}\n          text={i18n.t`Back`}\n          onClick={routeToZoneList}\n          disabled={state.isSubmitting}\n        />\n      </FlexColumn>\n      <FlexColumn widthGrowIndex={0.4} padding=\"0\">\n        <CanMutate mutationName=\"updateZone\">\n          <FormSubmitButton>\n            <Trans>Save zone</Trans>\n          </FormSubmitButton>\n        </CanMutate>\n      </FlexColumn>\n    </FlexRowSingle>\n  ))\n}\n","import { useXFieldState, useXFormState } from '@speedlo/xform'\nimport { observer } from 'mobx-react-lite'\nimport React from 'react'\nimport Goodbye from 'react-goodbye'\nimport styled from 'styled-components'\n\nimport { CanMutate } from '../../../atoms/CanMutate'\nimport { Card } from '../../../atoms/Card'\nimport { ConfirmDialog } from '../../../atoms/ConfirmDialog'\nimport { useMZoneDelete } from '../../../graph/generated'\nimport { i18n } from '../../../i18n'\nimport { TouchButtonDelete } from '../../../molecules/TouchButtonDelete'\nimport { Spacing } from '../../../styling'\nimport { useZoneRouteControl } from '../hooks/useZoneRouteControl'\nimport { ZoneFormContent } from '../molecules/ZoneFormContent'\nimport { ZoneFormControls } from '../molecules/ZoneFormControls'\nimport { TZoneFormValues } from '../zones.types'\n\nconst DeleteButtonContainer = styled.div`\n  width: ${Spacing.ButtonHeight + Spacing.DefaultSizeUnit};\n  margin-top: ${Spacing.Middle};\n`\n\ninterface IProps {\n  zoneId: MaybeID\n}\n\nexport const ZoneFormPanel = observer<IProps>(({ zoneId }) => {\n  const { routeToZoneList } = useZoneRouteControl()\n\n  const [deleteZone] = useMZoneDelete()\n\n  const onDelete = React.useCallback(async () => {\n    if (zoneId) {\n      await deleteZone({ zoneId })\n    }\n    routeToZoneList()\n  }, [deleteZone, routeToZoneList, zoneId])\n\n  const state = useXFormState<TZoneFormValues>()\n\n  const { value: type } = useXFieldState('type')\n\n  return (\n    <Card padding={0}>\n      <ZoneFormControls />\n      <ZoneFormContent type={type} />\n\n      <CanMutate mutationName=\"destroyZone\">\n        <DeleteButtonContainer>\n          <TouchButtonDelete\n            disabled={state.isSubmitting}\n            confirmText={i18n.t`Remove zone ${state.values.name}?`}\n            onDelete={onDelete}\n          />\n        </DeleteButtonContainer>\n      </CanMutate>\n\n      <Goodbye when={state.isDirty}>\n        {({ isShow, handleOk, handleCancel }) => (\n          <ConfirmDialog\n            isShow={isShow}\n            confirmText={i18n.t`Do you want to cancel changes for the zone?`}\n            onConfirm={handleOk}\n            onCancel={handleCancel}\n          />\n        )}\n      </Goodbye>\n    </Card>\n  )\n})\n","import { observer } from 'mobx-react-lite'\n\nimport { useRoot } from './RootProvider'\n\nexport const UserHasMultipleBranches = observer(({ children }) => {\n  const { user } = useRoot()\n  return user.hasSingleBranch ? null : (children as any)\n})\n","import { Trans } from '@lingui/macro'\nimport React from 'react'\nimport styled from 'styled-components/macro'\n\nimport { ZoneTypeEnum } from '../../../graph/generated'\nimport { Colors } from '../../../styling'\n\ninterface IProps {\n  type: ZoneTypeEnum\n}\n\nconst StyledZoneListSection = styled.p`\n  color: ${Colors.greyMiddle};\n`\n\nexport const ZoneListSection: React.FC<IProps> = ({ type }) => {\n  if (type === ZoneTypeEnum.Return) {\n    return (\n      <StyledZoneListSection>\n        <Trans>\n          Notification will be shown when driver enters one of these zones.\n        </Trans>\n      </StyledZoneListSection>\n    )\n  }\n  return null\n}\n","import { AddCircle } from '@material-ui/icons'\nimport { observer } from 'mobx-react-lite'\nimport React from 'react'\n\nimport { useMZoneCreate, ZoneTypeEnum } from '../../../graph/generated'\nimport { generatePolygon } from '../../../helpers/gps'\nimport { useSnackBar } from '../../../hooks/useSnackBar'\nimport { i18n } from '../../../i18n'\nimport { TouchButton } from '../../../molecules/TouchButton'\nimport { Colors, Spacing } from '../../../styling'\nimport { useZoneModel } from '../hooks/useZoneModel'\nimport { useZoneRouteControl } from '../hooks/useZoneRouteControl'\n\ninterface IProps {\n  type: ZoneTypeEnum\n}\n\nexport const CreateZoneButton = observer<IProps>(({ type }) => {\n  const zoneModel = useZoneModel()\n  const { routeToZoneEdit } = useZoneRouteControl()\n\n  const [createZone] = useMZoneCreate()\n  const { enqueueSuccess } = useSnackBar()\n\n  const [disabled, setDisabled] = React.useState(false)\n\n  const onClick = async () => {\n    if (!zoneModel.branch) {\n      return\n    }\n    setDisabled(true)\n    const result = await createZone({\n      type,\n      branchId: zoneModel.branch.id,\n      points: generatePolygon({\n        center: zoneModel.branch.gps,\n        metersRadius: 1000,\n        pointsCount: 5,\n      }),\n    })\n    if (result) {\n      enqueueSuccess(i18n.t`Zone has been created`)\n      routeToZoneEdit(result.createZone.id)\n    }\n  }\n\n  const createTextByType = {\n    [ZoneTypeEnum.Area]: i18n.t`Create delivery zone for branch`,\n    [ZoneTypeEnum.Return]: i18n.t`Create return zone for branch`,\n  }\n\n  const colorByType = {\n    [ZoneTypeEnum.Area]: Colors.turquoise,\n    [ZoneTypeEnum.Return]: Colors.greyMiddle,\n  }\n\n  const text = zoneModel.hasBranchFilter\n    ? createTextByType[type]\n    : i18n.t`Select branch to create zone`\n\n  return (\n    <TouchButton\n      text={text}\n      onClick={onClick}\n      disabled={disabled || !zoneModel.hasBranchFilter}\n      color={colorByType[type]}\n      height={Spacing.ButtonHeight + Spacing.DefaultSizeUnit}\n      textNextToIcon\n      icon={AddCircle}\n    />\n  )\n})\n","import { Edit } from '@material-ui/icons'\nimport Color from 'color'\nimport React from 'react'\nimport { SortableElement } from 'react-sortable-hoc'\nimport styled from 'styled-components'\n\nimport { Card } from '../../../atoms/Card'\nimport { DragHandle } from '../../../atoms/DragHandle'\nimport { FlexColumn } from '../../../atoms/FlexColumn'\nimport { FlexRowSingle } from '../../../atoms/FlexRowSingle'\nimport { SizerButton } from '../../../atoms/SizerButton'\nimport {\n  FCompanyBranchFragment,\n  FZoneFragment,\n  ZoneTypeEnum,\n} from '../../../graph/generated'\nimport { TouchButton } from '../../../molecules/TouchButton'\nimport { Colors, Spacing } from '../../../styling'\n\ninterface IProps {\n  type: ZoneTypeEnum\n  zone: FZoneFragment\n  branch: FCompanyBranchFragment\n  onEdit(): void\n}\n\ninterface IStyledProps {\n  type: ZoneTypeEnum\n  color: string\n}\n\nconst StyledZoneListCard = styled(Card)<IStyledProps>`\n  background: ${getBackgroundColor};\n`\n\nfunction getBackgroundColor({ color, type }: IStyledProps) {\n  if (type === ZoneTypeEnum.Area) {\n    return ''\n  }\n  const baseColor = Color(color)\n    .alpha(0.8)\n    .darken(0.2)\n  const lighterColor = baseColor.lighten(0.4)\n  return `repeating-linear-gradient(135deg, ${baseColor}, ${baseColor} 10px, ${lighterColor} 10px, ${lighterColor} 20px)`\n}\n\nconst ZoneNameStyled = styled.div`\n  font-size: 1.125rem;\n  margin-top: 0.2rem;\n`\n\nconst ZoneDescriptionStyled = styled.div`\n  font-size: 0.875rem;\n`\nconst ZoneFlexRowStyled = styled(FlexRowSingle)`\n  height: ${Spacing.ButtonHeight + Spacing.DefaultSizeUnit};\n`\n\nexport const ZoneListCard = SortableElement(\n  ({ zone, branch, type, onEdit }: IProps) => (\n    <StyledZoneListCard\n      key={zone.id}\n      type={type}\n      padding={0}\n      color={zone.enabled ? zone.zoneColor.color : Colors.greyMiddle}\n      onClick={onEdit}\n    >\n      <ZoneFlexRowStyled>\n        <FlexColumn fixedWidth padding=\"0 0.5rem 0 0\">\n          <SizerButton>\n            <TouchButton icon={Edit} />\n          </SizerButton>\n        </FlexColumn>\n        <FlexColumn widthGrowIndex={1}>\n          <ZoneNameStyled>\n            {zone.name}\n            {` [P${zone.priority}]`}\n          </ZoneNameStyled>\n          <ZoneDescriptionStyled>{branch.name}</ZoneDescriptionStyled>\n        </FlexColumn>\n        <FlexColumn padding=\"0\">\n          <DragHandle />\n        </FlexColumn>\n      </ZoneFlexRowStyled>\n    </StyledZoneListCard>\n  ),\n)\n","import React from 'react'\nimport { SortableContainer, SortEndHandler } from 'react-sortable-hoc'\nimport styled from 'styled-components/macro'\n\nimport { ZoneTypeEnum } from '../../../graph/generated'\n\ninterface IProps {\n  type: ZoneTypeEnum\n  children: ReactNodes\n  onSort: SortEndHandler\n}\n\nconst ZoneListContainerStyled = styled.div`\n  margin-top: 0.5rem;\n  cursor: arrow;\n`\n\nconst SortableZoneList = SortableContainer(ZoneListContainerStyled)\n\nexport const ZoneListCardGroup: React.FC<IProps> = ({\n  type,\n  onSort,\n  children,\n}) => {\n  return (\n    <SortableZoneList\n      onSortEnd={onSort}\n      useDragHandle\n      lockAxis=\"y\"\n      lockToContainerEdges\n    >\n      {children}\n    </SortableZoneList>\n  )\n}\n","import React from 'react'\nimport { SortEndHandler } from 'react-sortable-hoc'\n\nimport { useMZoneUpdatePriority, ZoneTypeEnum } from '../../../graph/generated'\nimport { RM } from '../../../tools/ramda'\nimport { TZoneInList } from '../zones.types'\nimport { useZoneListQuery } from './useZoneListQuery'\n\nconst sortZones = RM.sortWith<TZoneInList>([\n  RM.ascend(RM.path(['companyBranch', 'name'])),\n  RM.descend(RM.prop('priority')),\n])\n\nconst groupByBranch = RM.groupBy((zone: TZoneInList) => zone.companyBranch.id)\nconst isZoneType = RM.pathEq(['zoneType', 'enum'])\n\nexport function useZoneListControl(type: ZoneTypeEnum) {\n  const { zones, loading } = useZoneListQuery()\n\n  const zonesByBranch = React.useMemo(() => {\n    if (!zones) {\n      return null\n    }\n    return RM.mapObjIndexed(\n      sortZones,\n      groupByBranch(zones.filter(isZoneType(type))),\n    )\n  }, [type, zones])\n\n  const [updatePriority] = useMZoneUpdatePriority()\n\n  const onZoneSort: SortEndHandler = React.useCallback(\n    ({ oldIndex, newIndex, collection }) => {\n      if (!zonesByBranch) {\n        return\n      }\n      const group = zonesByBranch[collection]\n      const zone = group[oldIndex]\n\n      const offset = oldIndex - newIndex\n\n      updatePriority(\n        {\n          zoneId: zone.id,\n          offset,\n        },\n        {\n          optimisticResponse: {\n            __typename: 'Mutation',\n            updateZonePriority: [\n              {\n                __typename: 'Zone',\n                id: zone.id,\n                priority: zone.priority + offset,\n              },\n            ],\n          },\n        },\n      )\n    },\n    [zonesByBranch, updatePriority],\n  )\n\n  return { isLoading: loading, zonesByBranch, onZoneSort }\n}\n","import { Trans } from '@lingui/macro'\nimport { observer } from 'mobx-react-lite'\nimport React, { Fragment } from 'react'\nimport { BulletList } from 'react-content-loader'\n\nimport { CardListTitle } from '../../../atoms/CardListTitle'\nimport { ZoneTypeEnum } from '../../../graph/generated'\nimport { idPropEq } from '../../../tools/ramda'\nimport { ZoneListCard } from '../atoms/ZoneListCard'\nimport { ZoneListCardGroup } from '../atoms/ZoneListCardGroup'\nimport { useZoneListControl } from '../hooks/useZoneListControl'\nimport { useZoneModel } from '../hooks/useZoneModel'\nimport { useZoneRouteControl } from '../hooks/useZoneRouteControl'\nimport { TBranch, TZoneInList } from '../zones.types'\n\ninterface IProps {\n  type: ZoneTypeEnum\n}\n\nexport const ZoneList = observer<IProps>(({ type }) => {\n  const zoneModel = useZoneModel()\n  const { routeToZoneEdit } = useZoneRouteControl()\n  const { isLoading, zonesByBranch, onZoneSort } = useZoneListControl(type)\n\n  if (isLoading === null) {\n    return <BulletList primaryOpacity={0.2} secondaryOpacity={0.2} />\n  }\n\n  if (zonesByBranch === null) {\n    return (\n      <CardListTitle>\n        <Trans>Select brand to see its zones</Trans>\n      </CardListTitle>\n    )\n  }\n\n  const branches = zoneModel.root.user.filterBranches(\n    zoneModel.branchFilterPredicate,\n  )\n\n  const renderZone = (zone: TZoneInList, idx: number) => (\n    <ZoneListCard\n      key={zone.id}\n      type={type}\n      zone={zone}\n      branch={branches.find(idPropEq(zone.companyBranch.id))!}\n      onEdit={() => routeToZoneEdit(zone.id)}\n      index={idx}\n      collection={zone.companyBranch.id}\n    />\n  )\n\n  const renderBranch = (branch: TBranch, branchZones: RoA<TZoneInList>) => (\n    <Fragment key={branch.id}>\n      <CardListTitle>{branch.name}</CardListTitle>\n      {branchZones.map(renderZone)}\n    </Fragment>\n  )\n\n  return (\n    <ZoneListCardGroup type={type} onSort={onZoneSort}>\n      {branches.map(branch => {\n        const branchZones = zonesByBranch[branch.id]\n        return branchZones ? renderBranch(branch, branchZones) : null\n      })}\n    </ZoneListCardGroup>\n  )\n})\n","import { autorun } from 'mobx'\nimport { observer } from 'mobx-react-lite'\nimport React from 'react'\n\nimport { useRoot } from '../../../atoms/RootProvider'\nimport { VerticalGap } from '../../../atoms/VerticalGap'\nimport { FCompanyBranchBrand } from '../../../graph/generated'\nimport { RM } from '../../../tools/ramda'\nimport { CompanyBranchDropdown } from '../../../molecules/CompanyBranchDropdown'\nimport { CompanyBrandDropdown } from '../../../molecules/CompanyBrandDropdown'\n\nexport const ZoneFilter: React.FC = observer(() => {\n  const { user, zone } = useRoot()\n  const branches = user.branches\n\n  const getBrandBranches = React.useCallback(\n    (brand: Maybe<FCompanyBranchBrand>) =>\n      brand === null\n        ? []\n        : user.branches.filter(RM.pathEq(['brand', 'id'], brand.id)),\n    [user.branches],\n  )\n\n  React.useEffect(\n    () =>\n      autorun(() => {\n        if (branches.length === 1) {\n          zone.setBranchFilter(RM.head(branches)!)\n        }\n      }),\n    [branches, zone],\n  )\n\n  // no filter is shown for less than 1 branch available\n  if (branches.length <= 1) {\n    return null\n  }\n\n  const singleBrand = user.brands.length === 1 ? RM.head(user.brands)! : null\n  if (singleBrand) {\n    zone.setBrandFilter(singleBrand, getBrandBranches(zone.brand))\n  }\n\n  return (\n    <>\n      {!singleBrand && (\n        <CompanyBrandDropdown\n          selectedBrand={zone.brand}\n          onSelection={brand => {\n            if (brand === null) {\n              zone.clearBrandFilter()\n            } else {\n              zone.setBrandFilter(brand, getBrandBranches(brand))\n            }\n          }}\n        />\n      )}\n      {!singleBrand && <VerticalGap />}\n      <CompanyBranchDropdown\n        branches={getBrandBranches(zone.brand)}\n        selectedBranch={zone.branch}\n        autoFocus={Boolean(singleBrand)}\n        formatOptionLabel={RM.prop('name')}\n        isClearable={true}\n        onSingleSelection={branch => {\n          if (!branch) {\n            zone.clearBranchFilter()\n          } else {\n            zone.setBranchFilter(branch)\n          }\n        }}\n      />\n    </>\n  )\n})\n","import { Trans } from '@lingui/react'\nimport { useObserver } from 'mobx-react-lite'\nimport React from 'react'\nimport styled from 'styled-components'\n\nimport { CanMutate } from '../../../atoms/CanMutate'\nimport { Card } from '../../../atoms/Card'\nimport { UserHasMultipleBranches } from '../../../atoms/UserHasMultipleBranches'\nimport { ZoneTypeEnum } from '../../../graph/generated'\nimport { useAutorunWhenSingleBranch } from '../../../hooks/useAutorunWhenSingleBranch'\nimport { ZoneListSection } from '../atoms/ZoneListSection'\nimport { useZoneModel } from '../hooks/useZoneModel'\nimport { CreateZoneButton } from '../molecules/CreateZoneButton'\nimport { ZoneList } from '../molecules/ZoneList'\nimport { ZoneFilter } from './ZoneFilter'\n\nconst StyledZoneMenuPanel = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n\n  & div.header {\n    flex: 0 0 auto;\n  }\n\n  & div.zone-list {\n    flex: 1 1 0;\n  }\n\n  & h3 {\n    margin-top: 6rem;\n  }\n`\n\nexport const ZoneMenuPanel = React.memo(() => {\n  const zoneModel = useZoneModel()\n\n  useAutorunWhenSingleBranch(branch => {\n    zoneModel.setBranchFilter(branch)\n  })\n\n  return useObserver(() => (\n    <StyledZoneMenuPanel>\n      <div className=\"header\">\n        <UserHasMultipleBranches>\n          <Card>\n            <ZoneFilter />\n          </Card>\n        </UserHasMultipleBranches>\n      </div>\n\n      <div className=\"zone-list\">\n        {zoneModel.zoneTypes.map((type, idx) => (\n          <div className={`list${idx}`} key={type}>\n            {type === ZoneTypeEnum.Return && (\n              <h3>\n                <Trans>Service zones</Trans>\n              </h3>\n            )}\n            <CanMutate mutationName=\"createZone\">\n              <CreateZoneButton type={type} />\n            </CanMutate>\n            <ZoneListSection type={type} />\n\n            <ZoneList type={type} />\n          </div>\n        ))}\n      </div>\n    </StyledZoneMenuPanel>\n  ))\n})\n","import React from 'react'\nimport { RouteComponentProps } from 'react-router-dom'\n\nimport { i18n } from '../../../i18n'\nimport { PageLayoutFullHeightItem } from '../../../molecules/PageLayoutFullHeightItem'\nimport { PageLayoutResponsive } from '../../../molecules/PageLayoutResponsive'\nimport { ROUTE_SETTINGS } from '../../settings/settings.routes'\nimport { ZoneFormLoader } from '../molecules/ZoneFormLoader'\nimport { ZoneMap } from '../molecules/ZoneMap'\nimport { ZoneFormPanel } from '../organisms/ZoneFormPanel'\nimport { ZoneMenuPanel } from '../organisms/ZoneMenuPanel'\n\ninterface IProps extends RouteComponentProps<{ zoneId?: ID }> {}\n\nexport const ZonesOverviewPage: React.FC<IProps> = ({ match }) => {\n  const zoneId = match.params.zoneId || null\n  const isEditing = Boolean(zoneId)\n  return (\n    <PageLayoutResponsive\n      pageTitle={i18n.t`Delivery zones`}\n      backRoute={ROUTE_SETTINGS}\n      useBackButton\n    >\n      <ZoneFormLoader zoneId={zoneId}>\n        <PageLayoutFullHeightItem\n          widthInColumns={6}\n          column={10}\n          rowInMobile={2}\n          withScrollArea={true}\n        >\n          {isEditing ? <ZoneFormPanel zoneId={zoneId} /> : <ZoneMenuPanel />}\n        </PageLayoutFullHeightItem>\n        <PageLayoutFullHeightItem\n          widthInColumns={10}\n          rowInMobile={1}\n          forcePercentHeightInMobile={60}\n        >\n          <ZoneMap zoneId={zoneId} />\n        </PageLayoutFullHeightItem>\n      </ZoneFormLoader>\n    </PageLayoutResponsive>\n  )\n}\n","import React from 'react'\nimport { Route, Switch } from 'react-router-dom'\n\nimport { NotFoundPage } from '../../../pages/NotFoundPage'\nimport { ROUTE_SETTINGS_ZONES } from '../../settings/settings.routes'\nimport { ZonesOverviewPage } from '../pages/ZonesOverviewPage'\n\ninterface IProps {}\n\nexport const ZonesRouting: React.FC<IProps> = () => (\n  <Switch>\n    <Route\n      path={`${ROUTE_SETTINGS_ZONES}/:zoneId?`}\n      component={ZonesOverviewPage}\n    />\n    <Route component={NotFoundPage} />\n  </Switch>\n)\n\nexport default ZonesRouting\n"],"sourceRoot":""}