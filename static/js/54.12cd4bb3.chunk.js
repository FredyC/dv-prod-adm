(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{7712:function(e,t,n){"use strict";t.__esModule=!0;var o,r=n(5796),l=(o=r)&&o.__esModule?o:{default:o};t.default=function(e,t,n){return t in e?(0,l.default)(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},7717:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PageLayoutFullHeightItem=void 0;var o=i(n(0)),r=i(n(45)),l=n(7730),a=n(46);function i(e){return e&&e.__esModule?e:{default:e}}const u=r.default.div.withConfig({displayName:"FullHeightDiv"})`
  position: fixed;
  bottom: 0.5rem;
  width: ${(()=>e=>void 0!==e.widthInColumns?"calc(("+e.widthInColumns+" * 6.22vw) - "+a.Spacing.LayoutGridCellMargin+")":"calc(100vh - (2 * "+a.Spacing.LayoutGridCellMargin+"))")()};
  left: ${(()=>e=>void 0!==e.column?"calc(("+e.column+" * 6.22vw) + "+a.Spacing.LayoutGridCellMargin+")":a.Spacing.LayoutGridCellMargin)()};
  top: ${(()=>e=>void 0!==e.row?"calc(("+e.row+" * 3.9375rem) + "+a.Spacing.LayoutGridCellMargin+")":"calc(3.9375rem + "+a.Spacing.LayoutGridCellMargin+")")()};
`,d=r.default.div.withConfig({displayName:"FullHeightDivStyled"})`
  height: 100%;
`;t.PageLayoutFullHeightItem=(({children:e,row:t=1,column:n=0,widthInColumns:r=16,withScrollArea:a=!1,scrollAreaId:i})=>o.default.createElement(u,{column:n,row:t,widthInColumns:r,withScrollArea:a},a?o.default.createElement(l.ScrollArea,{id:i},e):o.default.createElement(d,null,e)))},7718:function(e,t,n){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.FlexRowSingle=void 0;const r=((o=n(45))&&o.__esModule?o:{default:o}).default.div.withConfig({displayName:"FlexRowSingle"})`
  display: flex;
  flex-direction: row;
  justify-content: ${({justify:e="space-between"})=>e};
`;t.FlexRowSingle=r},7722:function(e,t,n){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.VerticalGap=void 0;const r=((o=n(45))&&o.__esModule?o:{default:o}).default.div.withConfig({displayName:"VerticalGap"})`
  height: ${({size:e=1,sizeUnit:t="rem"})=>`${e}${t}`};
`;t.VerticalGap=r,r.displayName="VerticalGap"},7727:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useSnackBar=function(){const e=(0,l.useContext)(r.SnackbarContextNext),t=(0,l.useCallback)(t=>e(t,a),[]),n=(0,l.useCallback)(t=>e(t,i),[]),o=(0,l.useCallback)(t=>e(t,u),[]),c=(0,l.useCallback)(t=>e(t,d),[]);return{enqueueSnackbar:e,enqueueSuccess:t,enqueueError:n,enqueueWarning:o,enqueueInfo:c}};var o,r=n(280),l=n(0);!function(e){e.default="default",e.error="error",e.success="success",e.warning="warning",e.info="info"}(o||(o={}));const a={variant:o.success},i={variant:o.error},u={variant:o.warning},d={variant:o.info}},7729:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return(0,o.useContext)(r.__RouterContext)};var o=n(0),r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};o.get||o.set?Object.defineProperty(t,n,o):t[n]=e[n]}return t.default=e,t}(n(24))},7730:function(e,t,n){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.ScrollArea=void 0;const r=((o=n(45))&&o.__esModule?o:{default:o}).default.div.withConfig({displayName:"ScrollArea"})`
  overflow-y: scroll;
  -webkit-overflow-scrolling: touch;
  height: 100%;
`;t.ScrollArea=r},7747:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CardListTitle=void 0;var o,r=(o=n(45))&&o.__esModule?o:{default:o},l=n(46);const a=r.default.h2.withConfig({displayName:"CardListTitle"})`
  color: ${l.Colors.greyLight};
  font-weight: lighter;
  font-size: 1.2rem;
  margin: 0.8rem 0 0.8rem 0.3rem;
`;t.CardListTitle=a},7761:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useZoneRouteControl=function(){const{user:e,zone:t}=(0,r.useRoot)(),{history:n}=(0,l.default)(),o=e=>`/settings/zones/${e}`;return{getRouteToZone:o,routeToZoneEdit(r){t.map.panToZone(r),e.canQuery("zone")&&n.push(o(r))},routeToZoneList(){n.push("/settings/zones")}}};var o,r=n(93),l=(o=n(7729))&&o.__esModule?o:{default:o}},7787:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useZoneList=t.ZoneListLoader=void 0;var o=n(94),r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};o.get||o.set?Object.defineProperty(t,n,o):t[n]=e[n]}return t.default=e,t}(n(0)),l=n(93),a=n(47),i=n(8294);const u=r.default.createContext(null),d=(0,o.observer)(({children:e})=>{const{zone:t}=(0,l.useRoot)(),n=t.branches.filter(t.branchFilterPredicate);return 0===n.length?r.default.createElement(u.Provider,{value:[]},e):r.default.createElement(i.QueryZones,{variables:{branchesId:n.map(a.RM.prop("id"))},renderLoading:!1,render:({zones:t},{loading:n})=>r.default.createElement(u.Provider,{value:n?null:t},e)})});t.ZoneListLoader=d;t.useZoneList=(()=>(0,r.useContext)(u))},7789:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DragHandle=void 0;var o=i(n(0)),r=n(7762),l=i(n(45)),a=n(150);function i(e){return e&&e.__esModule?e:{default:e}}const u=l.default.div.withConfig({displayName:"DragHandleContainerStyled"})`
  padding: 1rem 0.4rem;
  cursor: grab;
`,d=(0,r.SortableHandle)(()=>o.default.createElement(u,null,o.default.createElement(a.Icon,{iconName:"reorder"})));t.DragHandle=d},7809:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseMap=void 0;var o=n(5792),r=u(n(0)),l=n(7746),a=u(n(45)),i=n(46);function u(e){return e&&e.__esModule?e:{default:e}}const d=a.default.div.withConfig({displayName:"MapContainerStyled"})`
  border-radius: ${i.Radiuses.Card};
  overflow: hidden;
  height: 100%;
`,c=(0,l.withGoogleMap)(({children:e})=>r.default.createElement(r.default.Fragment,null,e));t.BaseMap=(({model:e,children:t})=>{const n={streetViewControl:!1,mapTypeControl:!1,fullscreenControl:!1};return r.default.createElement(c,{containerElement:r.default.createElement(d,null),mapElement:r.default.createElement("div",{style:{height:"100%"}})},r.default.createElement(o.Observer,null,()=>r.default.createElement(l.GoogleMap,{ref:e.setMapRef,zoom:e.zoom,center:e.center,onCenterChanged:e.updatePosition,onZoomChanged:e.updateZoom,options:n},t)))})},7846:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FormInputSelect=void 0;var o,r=(o=n(0))&&o.__esModule?o:{default:o},l=n(7708),a=n(47),i=n(71),u=n(7716);function d(){return(d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}var c=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&(n[o[r]]=e[o[r]])}return n};class s extends r.default.Component{constructor(){super(...arguments),this.validate=(e=>this.props.isRequired&&!e?i.i18n._("{0} must be selected",{0:this.props.validatioName}):null)}getControlProps(e){const{isMulti:t,options:n,getOptionValue:o,defaultValue:r}=this.props,l=e.value||r;if(t){const t=Array.isArray(l)?e=>l.includes(o(e)):a.RM.F;return{value:Array.isArray(n)?n.filter(t):[],onChange:t=>{e.setValue(t.map(o))}}}return{value:l&&n.find(e=>o(e)===l),onChange:t=>{e.setValue(o(t))}}}render(){const e=this.props,{field:t,fieldIsPure:n=!1,defaultValue:o,isRequired:a=!1}=e,i=c(e,["field","fieldIsPure","defaultValue","isRequired"]);return r.default.createElement(l.Field,{field:t,validate:this.validate,pure:n},e=>r.default.createElement(u.SelectControl,d({},this.getControlProps(e),{onFocus:()=>e.setTouched(!0),styles:{control:t=>Boolean(e.error)?Object.assign({},t,{borderColor:"red"}):t}},i)))}}t.FormInputSelect=s,s.defaultProps={validatioName:"Value",getItemId:a.RM.prop("id")}},7847:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useZoneModel=function(){const{zone:e}=(0,o.useRoot)();return e};var o=n(93)},7929:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useZoneId=function(){const{match:e}=(0,r.default)(),{zoneId:t}=e.params;return t};var o,r=(o=n(7729))&&o.__esModule?o:{default:o}},7930:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZonePriceInput=void 0;var o=u(n(0)),r=u(n(45)),l=n(7710),a=n(71),i=n(46);function u(e){return e&&e.__esModule?e:{default:e}}const d=r.default.div.withConfig({displayName:"LabelStyled"})`
  min-width: 2rem;
  display: inline-block;
`,c=(0,r.default)(l.FormInputTextBox).withConfig({displayName:"FormInputTextBoxStyled"})`
  width: 3rem;
  position: relative;
  z-index: 4;
`,s=(0,r.default)(c).withConfig({displayName:"FormInputTextBoxDeliveryStyled"})`
  color: ${i.Colors.blue};
`,f=r.default.div.withConfig({displayName:"DeliveryContainer"})`
  position: relative;
  left: 8rem;
  top: 0rem;
`,p=r.default.div.withConfig({displayName:"PriceRangeContainer"})`
  position: relative;
  left: 4rem;
  top: -0.3rem;
  width: 3rem;
`,m=r.default.div.withConfig({displayName:"VerticalLine"})`
  border-left: 3px solid #707070;
  width: 3px;
  position: relative;
  left: -2rem;
  height: 4rem;
  float: left;
  margin: -0.5rem 0 0 0;
`,g=e=>{if("number"===typeof e)return null;const t=e.trim();return t.length&&Number.isNaN(Number.parseFloat(t))?a.i18n._("Must be number"):null},h=o.default.forwardRef(({field:e,label:t,isDeliveryPrice:n,autoFocus:r=!1},l)=>n?o.default.createElement(f,null,o.default.createElement(m,null),o.default.createElement(d,null,t),o.default.createElement(s,{field:e,validate:g,ref:l})):o.default.createElement(p,null,o.default.createElement(c,{field:e,validate:g,autoFocus:r})));t.ZonePriceInput=h},8285:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.ZoneMenuRoutes=void 0;var o,r=(o=n(0))&&o.__esModule?o:{default:o},l=n(24),a=n(275),i=n(8286),u=n(7761);const d=()=>{const{getRouteToZone:e}=(0,u.useZoneRouteControl)();return r.default.createElement(l.Switch,null,r.default.createElement(l.Route,{path:e(":zoneId?"),component:i.ZonePageLayout}),r.default.createElement(l.Route,{component:a.NotFoundPage}))};t.ZoneMenuRoutes=d;var c=d;t.default=c},8286:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZonePageLayout=void 0;var o,r=(o=n(0))&&o.__esModule?o:{default:o},l=n(71),a=n(5786),i=n(7717),u=n(8287),d=n(7787),c=n(8295),s=n(8299);t.ZonePageLayout=(({match:e})=>{const t=Boolean(e.params.zoneId);return r.default.createElement(d.ZoneListLoader,null,r.default.createElement(a.PageLayout,{pageTitle:l.i18n._("Delivery zones"),useBackButton:!0,backRoute:"/settings"}),r.default.createElement(i.PageLayoutFullHeightItem,{widthInColumns:6,column:10,withScrollArea:t},t?r.default.createElement(u.ZoneFormPanel,null):r.default.createElement(s.ZoneMenuPanel,null)),r.default.createElement(i.PageLayoutFullHeightItem,{widthInColumns:10},r.default.createElement(c.ZoneMapControl,null)))})},8287:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZoneFormPanel=void 0;var o=n(11),r=n(94),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};o.get||o.set?Object.defineProperty(t,n,o):t[n]=e[n]}return t.default=e,t}(n(0)),a=n(7708),i=M(n(5832)),u=M(n(45)),d=n(7711),c=n(5781),s=n(8288),f=n(5790),p=n(93),m=n(49),g=n(47),h=n(5791),v=n(7727),y=n(71),b=n(7742),C=n(46),_=n(7929),P=n(7761),O=n(8289),w=n(8293),E=n(7787);function M(e){return e&&e.__esModule?e:{default:e}}var Z=function(e,t,n,o){return new(n||(n=Promise))(function(r,l){function a(e){try{u(o.next(e))}catch(t){l(t)}}function i(e){try{u(o.throw(e))}catch(t){l(t)}}function u(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,i)}u((o=o.apply(e,t||[])).next())})};const j=u.default.div.withConfig({displayName:"DeleteButtonContainer"})`
  width: ${C.Spacing.ButtonHeight};
  margin-top: ${C.Spacing.Middle};
`;t.ZoneFormPanel=(()=>{const e=(0,_.useZoneId)(),t=(0,E.useZoneList)(),{zone:n}=(0,p.useRoot)(),{routeToZoneList:u}=(0,P.useZoneRouteControl)(),[C,M]=(0,l.useState)(!1),F=(0,l.useRef)(null),{enqueueError:S}=(0,v.useSnackBar)(),B=(0,l.useCallback)(()=>Z(void 0,void 0,void 0,function*(){F.current&&(yield F.current.submitForm(),M(!1),u())}),[]),x=(0,l.useCallback)(()=>Z(void 0,void 0,void 0,function*(){e&&(yield n.destroyZone(e)),u()}),[e]);(0,r.useDisposable)(()=>(0,o.reaction)(()=>null!==n.map.currentZonePoints,M)),(0,h.useEffectOnce)(()=>{t&&0===t.length&&(S(y.i18n._("Requested zone wasn't found")),u())});const L=e&&t&&t.find(g.RM.propEq("id",e))||null;return L?l.default.createElement(a.Form,{defaultValues:L,onChange:e=>{(0,m.logDebug)("zone form change",e.values),M(!0)},onSubmit:t=>n.saveZone(e,t),render:e=>(F.current=e,l.default.createElement(c.Card,{padding:0},l.default.createElement(w.ZoneFormControls,{isSubmitting:e.submitting,isModified:C,onSave:B,onGoBack:u}),l.default.createElement(O.ZoneFormContent,null),l.default.createElement(d.CanMutate,{mutationName:"destroyZone"},l.default.createElement(j,null,l.default.createElement(b.TouchButtonDelete,{disabled:e.submitting,confirmText:y.i18n._("Remove zone {0}?",{0:L.name}),onDelete:x}))),l.default.createElement(i.default,{when:C},({isShow:e,handleOk:t,handleCancel:n})=>l.default.createElement(s.ConfirmDialog,{isShow:e,confirmText:y.i18n._("Do you want to cancel changes for the zone?"),onConfirm:t,onCancel:n}))))}):l.default.createElement(f.Loading,{text:y.i18n._("Loading form...")})})},8288:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConfirmDialog=void 0;var o=n(0);t.ConfirmDialog=(e=>((0,o.useEffect)(()=>{e.isShow&&(window.confirm(e.confirmText)?e.onConfirm():e.onCancel())},[e.isShow]),null))},8289:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZoneFormContent=void 0;var o=n(122),r=v(n(0)),l=n(7708),a=v(n(45)),i=n(7783),u=n(7710),d=n(7715),c=n(7709),s=n(7735),f=n(71),p=n(46),m=n(7930),g=n(8290),h=n(8291);function v(e){return e&&e.__esModule?e:{default:e}}const y=a.default.div.withConfig({displayName:"ZoneFormContentStyled"})`
  margin: ${p.Spacing.Middle};
  color: ${p.Colors.black};
`,b=a.default.div.withConfig({displayName:"DescriptionUnderHeadline"})`
  color: ${p.Colors.greyDark};
  padding-bottom: 0.2rem;
`;t.ZoneFormContent=(e=>r.default.createElement(y,null,r.default.createElement(c.IconLine,{icon:"label"},r.default.createElement(u.FormInputTextBox,{field:"name",validate:(0,s.validateIsRequired)(f.i18n._("Zone name"))})),r.default.createElement(c.IconLine,{icon:"color_lens"},r.default.createElement(g.ZoneColorSelector,null)),r.default.createElement(i.FormInputCheckbox,{field:"enabled",name:"enabled",label:f.i18n._("Is active").toLocaleLowerCase()}),r.default.createElement(o.Trans,{id:"<0>Delivery cost</0><1>according order total cost</1>",components:[r.default.createElement(d.Headline,{margin:"0.5rem 0 0 0"}),r.default.createElement(b,null)]}),r.default.createElement(m.ZonePriceInput,{field:"minimalOrderPrice.value"}),r.default.createElement(l.NestedField,{field:"priceRangeRules",component:h.ZoneFormPriceRange})))},8290:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZoneColorSelector=void 0;var o=c(n(0)),r=c(n(45)),l=n(7846),a=n(61),i=n(47),u=n(46),d=n(289);function c(e){return e&&e.__esModule?e:{default:e}}const s=r.default.div.withConfig({displayName:"ColorOption"})`
  background-color: ${({color:e})=>e};
  color: ${u.Colors.white};
  width: 6rem;
  padding: 0.4rem 1rem;
  margin: 0;
  height: 100%;
`,f=(0,a.buildQuery)(d.ZoneColorsQuery);t.ZoneColorSelector=(({field:e="zoneColor.id"})=>o.default.createElement(f,{render:({zoneColors:t})=>o.default.createElement(l.FormInputSelect,{field:e,fieldIsPure:!0,options:[...t],width:8,styles:(()=>({option:e=>Object.assign({},e,{padding:0,margin:0}),menu:e=>Object.assign({},e,{width:"8rem",maxWidth:"8rem"})}))(),defaultValue:i.RM.head(t),getOptionValue:i.RM.prop("id"),formatOptionLabel:e=>o.default.createElement(s,{color:e.color},e.code)})}))},8291:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZoneFormPriceRange=void 0;var o,r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};o.get||o.set?Object.defineProperty(t,n,o):t[n]=e[n]}return t.default=e,t}(n(0)),l=n(7708),a=(o=n(45))&&o.__esModule?o:{default:o},i=n(5777),u=n(7742),d=n(46),c=n(8292),s=n(7930);const f=a.default.div.withConfig({displayName:"AddButtonContainer"})`
  position: relative;
  top: -6rem;
`,p=a.default.div.withConfig({displayName:"RemoveButtonContainer"})`
  position: relative;
  top: -7rem;
  left: 16rem;
`;t.ZoneFormPriceRange=(({fieldApi:e})=>r.default.createElement(r.default.Fragment,null,e.values.map((t,n,o)=>r.default.createElement(r.Fragment,{key:n},r.default.createElement(s.ZonePriceInput,{label:"za",isDeliveryPrice:!0,field:[n,"price","value"]}),n===o.length-1?r.default.createElement(c.ZonePlaceholderInput,{display:"\u221e",label:"do"}):r.default.createElement(s.ZonePriceInput,{field:[n,"toPrice","value"],autoFocus:!0}),o.length>1&&r.default.createElement(p,null,r.default.createElement(u.TouchButtonDelete,{onDelete:()=>e.removeValue("",n)})))),r.default.createElement(l.FormApi,{render:t=>r.default.createElement(f,null,r.default.createElement(i.TouchButton,{disabled:t.submitting,width:d.Spacing.ButtonHeight,iconName:"add_circle",onClick:()=>e.addValue("",{price:{value:0},toPrice:{value:0}})}))})))},8292:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZonePlaceholderInput=void 0;var o=a(n(0)),r=a(n(45)),l=n(7710);function a(e){return e&&e.__esModule?e:{default:e}}const i=r.default.div.withConfig({displayName:"LabelStyled"})`
  width: 3rem;
  display: inline-block;
`,u=(0,r.default)(l.FormInputStyled).withConfig({displayName:"FormInputForPlaceholderStyled"})`
  width: 3rem;
  position: relative;
  z-index: 4;
`,d=r.default.div.withConfig({displayName:"Container"})`
  margin: 0 0 0 1rem;
`;t.ZonePlaceholderInput=(({label:e,display:t})=>o.default.createElement(d,null,o.default.createElement(i,null,e),o.default.createElement(u,{disabled:!0,placeholder:t})))},8293:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZoneFormControls=void 0;var o,r=(o=n(0))&&o.__esModule?o:{default:o},l=n(7711),a=n(7724),i=n(7718),u=n(71),d=n(5777),c=n(46);t.ZoneFormControls=(({isSubmitting:e,isModified:t,onGoBack:n,onSave:o})=>r.default.createElement(i.FlexRowSingle,null,r.default.createElement(a.FlexColumn,{widthGrowIndex:.4,padding:"0"},r.default.createElement(d.TouchButton,{color:c.Colors.greyMiddle,onClick:n,text:u.i18n._("Back"),disabled:e})),r.default.createElement(a.FlexColumn,{widthGrowIndex:.4,padding:"0"},r.default.createElement(l.CanMutate,{mutationName:"updateZone"},r.default.createElement(d.TouchButton,{color:c.Colors.green,text:u.i18n._("Save zone"),onClick:o,disabled:e||!t})))))},8294:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QueryZones=t.ZonesQuery=void 0;var o,r=(o=n(21))&&o.__esModule?o:{default:o},l=n(61),a=n(289);const i=r.default`
  query GZones($branchesId: [ID!]!) {
    zones(companyBranches: $branchesId) {
      ...GZone
    }
  }
  ${a.ZoneFragment}
`;t.ZonesQuery=i;const u=(0,l.buildQuery)(i);t.QueryZones=u},8295:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZoneMapControl=void 0;var o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};o.get||o.set?Object.defineProperty(t,n,o):t[n]=e[n]}return t.default=e,t}(n(0)),r=n(7809),l=n(8296),a=n(46),i=n(8297),u=n(8298),d=n(7929),c=n(7847),s=n(7761),f=n(7787);function p(){return(p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}t.ZoneMapControl=(()=>{const e=(0,c.useZoneModel)(),t=(0,d.useZoneId)(),n=(0,f.useZoneList)(),{routeToZoneEdit:m}=(0,s.useZoneRouteControl)(),g=e.branches.filter(e.branchFilterPredicate),h=t=>!e.hasBranchFilter||t===e.branchFilterId,v=(0,o.useCallback)(e=>o.default.createElement(l.MapCompanyBranchMarker,{key:`branch${e.id}`,branch:e,isActive:h(e.id)}),[]);return o.default.createElement(r.BaseMap,{model:e.map},n&&n.map(n=>{const r={key:`zone${n.id}`,points:n.geoPolygon,priority:n.priority,color:h(n.companyBranch.id)&&n.enabled?n.zoneColor.color:a.Colors.greyMiddle};return n.id===t?o.default.createElement(u.ZoneMapEditableArea,p({},r,{onChange:e.map.updateZonePoints,onClear:e.map.clearZonePoints})):o.default.createElement(i.ZoneMapArea,p({},r,{onFocus:()=>{h(n.companyBranch.id)&&m(n.id)}}))}),g&&g.map(v))})},8296:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapCompanyBranchMarker=void 0;var o,r=(o=n(0))&&o.__esModule?o:{default:o},l=n(7746),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};o.get||o.set?Object.defineProperty(t,n,o):t[n]=e[n]}return t.default=e,t}(n(45)),i=n(124),u=n(46);const d=a.default.div.withConfig({displayName:"BranchNameStyled"})`
  ${function({isActive:e}){return a.css`
    background-color: ${e?u.Colors.green:u.Colors.greyLight};
    color: ${e?u.Colors.white:u.Colors.greyDark};
  `}} font-size: 1.3rem;
  white-space: nowrap;
  padding: 0.2rem 0.5rem;
`;t.MapCompanyBranchMarker=(({branch:e,isActive:t=!0})=>r.default.createElement(l.OverlayView,{getPixelPositionOffset:(e,t)=>({x:-e/2,y:-t/2}),mapPaneName:l.OverlayView.MARKER_LAYER,position:(0,i.gpsToLatLng)(e.gps)},r.default.createElement(d,{isActive:t},e.name)))},8297:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZoneMapArea=void 0;var o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};o.get||o.set?Object.defineProperty(t,n,o):t[n]=e[n]}return t.default=e,t}(n(0)),r=n(7746),l=n(124);t.ZoneMapArea=(e=>{const t=(0,o.useCallback)(t=>{e.onFocus&&(t.stop(),e.onFocus())},[e.onFocus]),{points:n,color:a,priority:i}=e;return o.default.createElement(r.Polygon,{defaultPath:n.map(l.gpsToLatLng),options:{fillColor:a,fillOpacity:.3,strokeWeight:0,zIndex:5e3-i},editable:!1,draggable:!1,onDblClick:t})})},8298:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZoneMapEditableArea=void 0;var o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};o.get||o.set?Object.defineProperty(t,n,o):t[n]=e[n]}return t.default=e,t}(n(0)),r=n(7746),l=n(124);t.ZoneMapEditableArea=(e=>{const t=(0,o.useRef)(null),n=(0,o.useCallback)(()=>{if(t.current){const n=t.current.getPath();e.onChange(n.getArray().map(l.latLngToGps))}},[e.onChange]);(0,o.useEffect)(()=>{let o;if(t.current&&e.onChange){const e=t.current.getPath();o=[e.addListener("set_at",n),e.addListener("insert_at",n),e.addListener("remove_at",n)]}return()=>{e.onClear(),o&&o.forEach(e=>e.remove())}},[]);const{points:a,color:i}=e;return o.default.createElement(r.Polygon,{defaultPath:a.map(l.gpsToLatLng),options:{fillColor:i,fillOpacity:.6,strokeWeight:2,zIndex:1e4},editable:!0,draggable:!0,ref:t,onDragEnd:n})})},8299:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZoneMenuPanel=void 0;var o=s(n(0)),r=s(n(45)),l=n(7711),a=n(5781),i=n(7730),u=n(8300),d=n(8301),c=n(8308);function s(e){return e&&e.__esModule?e:{default:e}}const f=r.default.div.withConfig({displayName:"ZoneMenuContainer"})`
  display: flex;
  flex-direction: column;
  height: 100%;
`,p=r.default.div.withConfig({displayName:"FixedHeaderContainer"})`
  flex: 0 0 auto;
`,m=r.default.div.withConfig({displayName:"ScrollAreaContainer"})`
  flex: 1 1 0;
  min-height: 0;
`;t.ZoneMenuPanel=(()=>o.default.createElement(f,null,o.default.createElement(p,null,o.default.createElement(a.Card,null,o.default.createElement(c.ZoneFilter,null)),o.default.createElement(l.CanMutate,{mutationName:"createZone"},o.default.createElement(u.CreateZoneButton,null))),o.default.createElement(m,null,o.default.createElement(i.ScrollArea,null,o.default.createElement(d.ZoneListControl,null)))))},8300:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CreateZoneButton=void 0;var o,r=n(94),l=(o=n(0))&&o.__esModule?o:{default:o},a=n(71),i=n(5777),u=n(46),d=n(7847),c=n(7761);const s=(0,r.observer)(()=>{const e=(0,d.useZoneModel)(),{routeToZoneEdit:t}=(0,c.useZoneRouteControl)();return l.default.createElement(i.TouchButton,{text:e.hasBranchFilter?a.i18n._("Create zone for branch"):a.i18n._("Select branch to create zone"),onClick:()=>e.createZone(t),disabled:!e.hasBranchFilter,color:u.Colors.turquoise,textNextToIcon:!0,height:u.Spacing.ButtonHeight,iconName:"add_circle"})});t.CreateZoneButton=s},8301:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZoneListControl=void 0;var o,r=n(122),l=(o=n(0))&&o.__esModule?o:{default:o},a=n(7786),i=n(7747),u=n(7847),d=n(7761),c=n(8302),s=n(7787);t.ZoneListControl=(()=>{const e=(0,s.useZoneList)();if(null===e)return l.default.createElement(a.BulletList,{primaryOpacity:.2,secondaryOpacity:.2});const t=(0,u.useZoneModel)(),{routeToZoneEdit:n}=(0,d.useZoneRouteControl)();return null===t.brand?l.default.createElement(i.CardListTitle,null,l.default.createElement(r.Trans,{id:"Select brand to see its zones"})):l.default.createElement(c.ZoneList,{zoneModel:t,zones:e.filter(t.zoneFilterPredicate),branches:t.root.user.filterBranches(t.branchFilterPredicate),onZoneEdit:n})})},8302:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZoneList=void 0;var o,r=c(n(175)),l=c(n(0)),a=n(7762),i=(o=n(45))&&o.__esModule?o:{default:o},u=n(7747),d=n(8307);function c(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};o.get||o.set?Object.defineProperty(t,n,o):t[n]=e[n]}return t.default=e,t}const s=(0,a.SortableContainer)(i.default.div`
  margin-top: 0.5rem;
  cursor: arrow;
`),f=r.sortWith([r.ascend(r.path(["companyBranch","name"])),r.descend(r.prop("priority"))]),p=r.groupBy(e=>e.companyBranch.id);t.ZoneList=(({branches:e,zones:t,zoneModel:n,onZoneEdit:o})=>{const a=(t,n)=>l.default.createElement(d.ZoneListCard,{key:t.id,zone:t,branch:e.find(r.propEq("id",t.companyBranch.id)),index:n,collection:t.companyBranch.id,onEdit:()=>o(t.id)});let i,c;if(1===e.length){const e=f(t);i=e.map(a),c=(({oldIndex:t,newIndex:o})=>{const r=e[t];n.changeZonePriority(r,t,o)})}else{const o=r.mapObjIndexed(f,p(t));i=e.map(e=>{const t=o[e.id];return t?((e,t)=>l.default.createElement(l.Fragment,{key:e.id},l.default.createElement(u.CardListTitle,null,e.name),t.map(a)))(e,t):null}),c=(({oldIndex:e,newIndex:t,collection:r})=>{const l=o[r][e];n.changeZonePriority(l,e,t)})}return l.default.createElement(s,{useDragHandle:!0,lockAxis:"y",onSortEnd:c},i)})},8307:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZoneListCard=void 0;var o=f(n(0)),r=n(7762),l=f(n(45)),a=n(5781),i=n(7789),u=n(7724),d=n(7718),c=n(5777),s=n(46);function f(e){return e&&e.__esModule?e:{default:e}}const p=l.default.div.withConfig({displayName:"ZoneNameStyled"})`
  font-size: 1.125rem;
  margin-top: 0.2rem;
`,m=l.default.div.withConfig({displayName:"ZoneDescriptionStyled"})`
  font-size: 0.875rem;
`,g=(0,l.default)(d.FlexRowSingle).withConfig({displayName:"ZoneFlexRowStyled"})`
  height: ${s.Spacing.ButtonHeight};
`,h=(0,r.SortableElement)(({zone:e,branch:t,onEdit:n})=>o.default.createElement(a.Card,{key:e.id,padding:0,color:e.enabled?e.zoneColor.color:s.Colors.greyMiddle,onClick:n},o.default.createElement(g,null,o.default.createElement(u.FlexColumn,{fixedWidth:!0,padding:"0 0.5rem 0 0"},o.default.createElement(c.TouchButton,{width:s.Spacing.ButtonHeight,height:s.Spacing.ButtonHeight,iconName:"mode_edit"})),o.default.createElement(u.FlexColumn,{widthGrowIndex:1},o.default.createElement(p,null,e.name,` [P${e.priority}]`),o.default.createElement(m,null,t.name)),o.default.createElement(u.FlexColumn,{padding:"0"},o.default.createElement(i.DragHandle,null)))));t.ZoneListCard=h},8308:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZoneFilter=void 0;var o=n(11),r=n(94),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};o.get||o.set?Object.defineProperty(t,n,o):t[n]=e[n]}return t.default=e,t}(n(0)),a=n(93),i=n(7722),u=n(47),d=n(8309),c=n(8310);const s=(0,r.observer)(()=>{const{user:e,zone:t}=(0,a.useRoot)(),n=e.branches,s=(0,l.useCallback)(t=>null===t?[]:e.branches.filter(u.RM.pathEq(["brand","id"],t.id)),[]);if((0,r.useDisposable)(()=>(0,o.autorun)(()=>{1===n.length&&t.setBranchFilter(u.RM.head(n))})),n.length<=1)return null;const f=1===e.brands.length?u.RM.head(e.brands):null;return f&&t.setBrandFilter(f,s(t.brand)),l.default.createElement(l.default.Fragment,null,!f&&l.default.createElement(c.ZoneFilterBrand,{brands:e.brands,selectedBrand:t.brand,onSelection:e=>{null===e?t.clearBrandFilter():t.setBrandFilter(e,s(e))}}),!f&&l.default.createElement(i.VerticalGap,null),l.default.createElement(d.ZoneFilterBranch,{branches:s(t.brand),selectedBranch:t.branch,autoFocus:Boolean(f),onSelection:e=>{e?t.setBranchFilter(e):t.clearBranchFilter()}}))});t.ZoneFilter=s},8309:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZoneFilterBranch=void 0;var o,r=(o=n(0))&&o.__esModule?o:{default:o},l=n(47),a=n(71),i=n(7743);t.ZoneFilterBranch=(({branches:e,selectedBranch:t,onSelection:n,autoFocus:o})=>r.default.createElement(i.CompanyBranchDropdown,{placeholder:a.i18n._("Select branch"),branches:e,selectedBranch:t,onSingleSelection:n,formatOptionLabel:l.RM.prop("name"),isClearable:!0,autoFocus:o}))},8310:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZoneFilterBrand=void 0;var o,r=(o=n(0))&&o.__esModule?o:{default:o},l=n(7716),a=n(47),i=n(71);t.ZoneFilterBrand=(({brands:e,selectedBrand:t,onSelection:n})=>r.default.createElement(l.SelectControl,{placeholder:i.i18n._("Select brand"),options:e,value:t,formatOptionLabel:a.RM.prop("name"),getOptionValue:a.RM.prop("id"),getOptionLabel:a.RM.prop("name"),isClearable:!0,isSearchable:!0,onChange:e=>n(e),autoFocus:!0}))}}]);
//# sourceMappingURL=54.12cd4bb3.chunk.js.map